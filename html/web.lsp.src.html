<!DOCTYPE HTML PUBLIC "4.01 Transitional"><html><title>Web</title><body><pre>
<font color='#555555'>#!/usr/bin/newlisp</font>
<font color='#555555'>;; <font color='#308080'>@module</font> Web</font>
<font color='#555555'>;; <font color='#308080'>@author</font> Jeff Ober &lt;jeffober@gmail.com&gt;, Kanen Flowers &lt;kanendosei@gmail.com&gt;</font>
<font color='#555555'>;; <font color='#308080'>@version</font> 0.3.2</font>
<font color='#555555'>;; <font color='#308080'>@location</font> http://www.ScruffyThinking.com/artful</font>
<font color='#555555'>;; <font color='#308080'>@package</font> https://github.com/LifeZero/artful-newlisp/blob/master/web.qwerty</font>
<font color='#555555'>;; <font color='#308080'>@description</font> A collection of functions for writing web-based software.</font>
<font color='#555555'>;; &lt;b&gt;Features:&lt;/b&gt;</font>
<font color='#555555'>;; &lt;ul&gt;</font>
<font color='#555555'>;;   &lt;li&gt;ASP/PHP-style templates&lt;/li&gt;</font>
<font color='#555555'>;;   &lt;li&gt;Cookies&lt;/li&gt;</font>
<font color='#555555'>;;   &lt;li&gt;Entities translation&lt;/li&gt;</font>
<font color='#555555'>;;   &lt;li&gt;GET/POST parameters&lt;/li&gt;</font>
<font color='#555555'>;;   &lt;li&gt;HTTP header control&lt;/li&gt;</font>
<font color='#555555'>;;   &lt;li&gt;Sessions&lt;/li&gt;</font>
<font color='#555555'>;;   &lt;li&gt;URL building and parsing&lt;/li&gt;</font>
<font color='#555555'>;;   &lt;li&gt;URL encoding and decoding&lt;/li&gt;</font>
<font color='#555555'>;;   &lt;li&gt;query building and parsing&lt;/li&gt;</font>
<font color='#555555'>;; &lt;/ul&gt;</font>
<font color='#555555'>;; &lt;b&gt;Known issues&lt;/b&gt;</font>
<font color='#555555'>;; &lt;ul&gt;</font>
<font color='#555555'>;;   &lt;li&gt;</font>
<font color='#555555'>;;     When used in conjunction with the official </font>
<font color='#555555'>;;     <font color='#308080'>@link</font> http://newlisp.nfshost.com/code/modules/cgi.lsp.html CGI</font>
<font color='#555555'>;;     module, <font color='#308080'>@link</font> http://newlisp.nfshost.com/code/modules/cgi.lsp.html CGI must be loaded first. In the case of</font>
<font color='#555555'>;;     identical GET and POST parameters, the value is stored in GET, but the value will be POST. This</font>
<font color='#555555'>;;     is due to the fact that CGI stores both GET and POST in the same association list and overwrites</font>
<font color='#555555'>;;     GET values with POST.</font>
<font color='#555555'>;;   &lt;/li&gt;</font>
<font color='#555555'>;; &lt;/ul&gt;</font>
<font color='#555555'>;; </font>
<font color='#555555'>;; &lt;b&gt;Note:&lt;/b&gt; for JSON encoding and decoding, see the <font color='#308080'>@link</font> http://static.artfulcode.net/newlisp/json.lsp.html Json module.</font>
<font color='#555555'>;; </font>
<font color='#555555'>;; &lt;h4&gt;To do&lt;/h4&gt;</font>
<font color='#555555'>;; &amp;bull; add MIME decoding for multipart posts</font>
<font color='#555555'>;;</font>
<font color='#555555'>;; &lt;h4&gt;Version history&lt;/h4&gt;</font>
<font color='#555555'>;; &lt;b&gt;0.3.1&lt;/b&gt;</font>
<font color='#555555'>;; &amp;bull; fixed ineffective usage of set/setf</font>
<font color='#555555'>;;</font>
<font color='#555555'>;; &lt;b&gt;0.3&lt;/b&gt;</font>
<font color='#555555'>;; &amp;bull; made parse-query more tolerant and fixed parsing bug</font>
<font color='#555555'>;; &amp;bull; cookie now accepts an additional parameter that only permits access during HTTPS sessions</font>
<font color='#555555'>;; </font>
<font color='#555555'>;; &lt;b&gt;0.2&lt;/b&gt;</font>
<font color='#555555'>;; &amp;bull; build-url now accepts query strings in addition to assoc lists</font>
<font color='#555555'>;; &amp;bull; session-id now accepts an optional parameter to set the session id</font>
<font color='#555555'>;; &amp;bull; fixed some typos with 'clean-sessions'</font>
<font color='#555555'>;; &amp;bull; fixed extra parameter in 'define-session-handlers'</font>
<font color='#555555'>;; </font>
<font color='#555555'>;; &lt;b&gt;0.1&lt;/b&gt;</font>
<font color='#555555'>;; &amp;bull; initial release</font>
<font color='#555555'>;; </font>
<font color='#AA0000'>(</font><font color='#0000AA'>context</font> 'Web<font color='#AA0000'>)</font>

<font color='#555555'>;===============================================================================</font>
<font color='#555555'>; !Constants and definitions</font>
<font color='#555555'>;===============================================================================</font>

<font color='#AA0000'>(</font><font color='#0000AA'>constant</font> 'POST_LIMIT <font color='#665500'>4096</font><font color='#AA0000'>)</font>

<font color='#AA0000'>(</font><font color='#0000AA'>define</font> GET<font color='#AA0000'>)</font>
<font color='#AA0000'>(</font><font color='#0000AA'>define</font> POST<font color='#AA0000'>)</font>
<font color='#AA0000'>(</font><font color='#0000AA'>define</font> COOKIE<font color='#AA0000'>)</font>

<font color='#AA0000'>(</font><font color='#0000AA'>define</font> SESSION_DIR <font color='#008800'>"/tmp"</font><font color='#AA0000'>)</font>
<font color='#AA0000'>(</font><font color='#0000AA'>define</font> SESSION_MAX_AGE <font color='#AA0000'>(</font><font color='#0000AA'>*</font> <font color='#665500'>60</font> <font color='#665500'>60</font> <font color='#665500'>24</font> <font color='#665500'>7</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font> <font color='#555555'>; seconds</font>
<font color='#AA0000'>(</font><font color='#0000AA'>define</font> SESSION_KEY <font color='#008800'>"NLWSESID"</font><font color='#AA0000'>)</font>
<font color='#AA0000'>(</font><font color='#0000AA'>define</font> SESSION_PREFIX <font color='#008800'>"NLWSES"</font><font color='#AA0000'>)</font>
<font color='#AA0000'>(</font><font color='#0000AA'>define</font> SESSION_STARTED<font color='#AA0000'>)</font>
<font color='#AA0000'>(</font><font color='#0000AA'>define</font> SESSION_ID<font color='#AA0000'>)</font> <font color='#555555'>; stores the current session id</font>

<font color='#555555'>;===============================================================================</font>
<font color='#555555'>; !Encoding and decoding</font>
<font color='#555555'>;===============================================================================</font>

<font color='#AA0000'>(</font><font color='#0000AA'>define</font> ENTITIES
  <font color='#AA0000'>(</font><font color='#0000AA'>list</font>
    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>34</font> <font color='#008800'>{&amp;quot&#059;}</font><font color='#AA0000'>)</font>       <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>38</font> <font color='#008800'>{&amp;amp&#059;}</font><font color='#AA0000'>)</font>        <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>39</font> <font color='#008800'>{&amp;apos&#059;}</font><font color='#AA0000'>)</font>       <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>60</font> <font color='#008800'>{&amp;lt&#059;}</font><font color='#AA0000'>)</font>
    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>62</font> <font color='#008800'>{&amp;gt&#059;}</font><font color='#AA0000'>)</font>         <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>160</font> <font color='#008800'>{&amp;nbsp&#059;}</font><font color='#AA0000'>)</font>      <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>161</font> <font color='#008800'>{&amp;iexcl&#059;}</font><font color='#AA0000'>)</font>     <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>162</font> <font color='#008800'>{&amp;cent&#059;}</font><font color='#AA0000'>)</font>
    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>163</font> <font color='#008800'>{&amp;pound&#059;}</font><font color='#AA0000'>)</font>     <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>164</font> <font color='#008800'>{&amp;curren&#059;}</font><font color='#AA0000'>)</font>    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>165</font> <font color='#008800'>{&amp;yen&#059;}</font><font color='#AA0000'>)</font>       <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>166</font> <font color='#008800'>{&amp;brvbar&#059;}</font><font color='#AA0000'>)</font>
    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>167</font> <font color='#008800'>{&amp;sect&#059;}</font><font color='#AA0000'>)</font>      <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>168</font> <font color='#008800'>{&amp;uml&#059;}</font><font color='#AA0000'>)</font>       <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>169</font> <font color='#008800'>{&amp;copy&#059;}</font><font color='#AA0000'>)</font>      <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>170</font> <font color='#008800'>{&amp;ordf&#059;}</font><font color='#AA0000'>)</font>
    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>171</font> <font color='#008800'>{&amp;laquo&#059;}</font><font color='#AA0000'>)</font>     <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>172</font> <font color='#008800'>{&amp;not&#059;}</font><font color='#AA0000'>)</font>       <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>173</font> <font color='#008800'>{&amp;shy&#059;}</font><font color='#AA0000'>)</font>       <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>174</font> <font color='#008800'>{&amp;reg&#059;}</font><font color='#AA0000'>)</font>
    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>175</font> <font color='#008800'>{&amp;macr&#059;}</font><font color='#AA0000'>)</font>      <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>176</font> <font color='#008800'>{&amp;deg&#059;}</font><font color='#AA0000'>)</font>       <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>177</font> <font color='#008800'>{&amp;plusmn&#059;}</font><font color='#AA0000'>)</font>    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>178</font> <font color='#008800'>{&amp;sup2&#059;}</font><font color='#AA0000'>)</font>
    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>179</font> <font color='#008800'>{&amp;sup3&#059;}</font><font color='#AA0000'>)</font>      <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>180</font> <font color='#008800'>{&amp;acute&#059;}</font><font color='#AA0000'>)</font>     <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>181</font> <font color='#008800'>{&amp;micro&#059;}</font><font color='#AA0000'>)</font>     <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>182</font> <font color='#008800'>{&amp;para&#059;}</font><font color='#AA0000'>)</font>
    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>183</font> <font color='#008800'>{&amp;middot&#059;}</font><font color='#AA0000'>)</font>    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>184</font> <font color='#008800'>{&amp;cedil&#059;}</font><font color='#AA0000'>)</font>     <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>185</font> <font color='#008800'>{&amp;sup1&#059;}</font><font color='#AA0000'>)</font>      <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>186</font> <font color='#008800'>{&amp;ordm&#059;}</font><font color='#AA0000'>)</font>
    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>187</font> <font color='#008800'>{&amp;raquo&#059;}</font><font color='#AA0000'>)</font>     <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>188</font> <font color='#008800'>{&amp;frac14&#059;}</font><font color='#AA0000'>)</font>    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>189</font> <font color='#008800'>{&amp;frac12&#059;}</font><font color='#AA0000'>)</font>    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>190</font> <font color='#008800'>{&amp;frac34&#059;}</font><font color='#AA0000'>)</font>
    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>191</font> <font color='#008800'>{&amp;iquest&#059;}</font><font color='#AA0000'>)</font>    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>192</font> <font color='#008800'>{&amp;Agrave&#059;}</font><font color='#AA0000'>)</font>    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>193</font> <font color='#008800'>{&amp;Aacute&#059;}</font><font color='#AA0000'>)</font>    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>194</font> <font color='#008800'>{&amp;Acirc&#059;}</font><font color='#AA0000'>)</font>
    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>195</font> <font color='#008800'>{&amp;Atilde&#059;}</font><font color='#AA0000'>)</font>    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>196</font> <font color='#008800'>{&amp;Auml&#059;}</font><font color='#AA0000'>)</font>      <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>197</font> <font color='#008800'>{&amp;Aring&#059;}</font><font color='#AA0000'>)</font>     <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>198</font> <font color='#008800'>{&amp;AElig&#059;}</font><font color='#AA0000'>)</font> 
    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>199</font> <font color='#008800'>{&amp;Ccedil&#059;}</font><font color='#AA0000'>)</font>    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>200</font> <font color='#008800'>{&amp;Egrave&#059;}</font><font color='#AA0000'>)</font>    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>201</font> <font color='#008800'>{&amp;Eacute&#059;}</font><font color='#AA0000'>)</font>    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>202</font> <font color='#008800'>{&amp;Ecirc&#059;}</font><font color='#AA0000'>)</font>
    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>203</font> <font color='#008800'>{&amp;Euml&#059;}</font><font color='#AA0000'>)</font>      <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>204</font> <font color='#008800'>{&amp;Igrave&#059;}</font><font color='#AA0000'>)</font>    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>205</font> <font color='#008800'>{&amp;Iacute&#059;}</font><font color='#AA0000'>)</font>    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>206</font> <font color='#008800'>{&amp;Icirc&#059;}</font><font color='#AA0000'>)</font>
    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>207</font> <font color='#008800'>{&amp;Iuml&#059;}</font><font color='#AA0000'>)</font>      <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>208</font> <font color='#008800'>{&amp;ETH&#059;}</font><font color='#AA0000'>)</font>       <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>209</font> <font color='#008800'>{&amp;Ntilde&#059;}</font><font color='#AA0000'>)</font>    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>210</font> <font color='#008800'>{&amp;Ograve&#059;}</font><font color='#AA0000'>)</font>
    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>211</font> <font color='#008800'>{&amp;Oacute&#059;}</font><font color='#AA0000'>)</font>    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>212</font> <font color='#008800'>{&amp;Ocirc&#059;}</font><font color='#AA0000'>)</font>     <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>213</font> <font color='#008800'>{&amp;Otilde&#059;}</font><font color='#AA0000'>)</font>    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>214</font> <font color='#008800'>{&amp;Ouml&#059;}</font><font color='#AA0000'>)</font>
    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>215</font> <font color='#008800'>{&amp;times&#059;}</font><font color='#AA0000'>)</font>     <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>216</font> <font color='#008800'>{&amp;Oslash&#059;}</font><font color='#AA0000'>)</font>    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>217</font> <font color='#008800'>{&amp;Ugrave&#059;}</font><font color='#AA0000'>)</font>    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>218</font> <font color='#008800'>{&amp;Uacute&#059;}</font><font color='#AA0000'>)</font>
    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>219</font> <font color='#008800'>{&amp;Ucirc&#059;}</font><font color='#AA0000'>)</font>     <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>220</font> <font color='#008800'>{&amp;Uuml&#059;}</font><font color='#AA0000'>)</font>      <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>221</font> <font color='#008800'>{&amp;Yacute&#059;}</font><font color='#AA0000'>)</font>    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>222</font> <font color='#008800'>{&amp;THORN&#059;}</font><font color='#AA0000'>)</font>
    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>223</font> <font color='#008800'>{&amp;szlig&#059;}</font><font color='#AA0000'>)</font>     <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>224</font> <font color='#008800'>{&amp;agrave&#059;}</font><font color='#AA0000'>)</font>    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>225</font> <font color='#008800'>{&amp;aacute&#059;}</font><font color='#AA0000'>)</font>    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>226</font> <font color='#008800'>{&amp;acirc&#059;}</font><font color='#AA0000'>)</font>
    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>227</font> <font color='#008800'>{&amp;atilde&#059;}</font><font color='#AA0000'>)</font>    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>228</font> <font color='#008800'>{&amp;auml&#059;}</font><font color='#AA0000'>)</font>      <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>229</font> <font color='#008800'>{&amp;aring&#059;}</font><font color='#AA0000'>)</font>     <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>230</font> <font color='#008800'>{&amp;aelig&#059;}</font><font color='#AA0000'>)</font>
    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>231</font> <font color='#008800'>{&amp;ccedil&#059;}</font><font color='#AA0000'>)</font>    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>232</font> <font color='#008800'>{&amp;egrave&#059;}</font><font color='#AA0000'>)</font>    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>233</font> <font color='#008800'>{&amp;eacute&#059;}</font><font color='#AA0000'>)</font>    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>234</font> <font color='#008800'>{&amp;ecirc&#059;}</font><font color='#AA0000'>)</font>
    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>235</font> <font color='#008800'>{&amp;euml&#059;}</font><font color='#AA0000'>)</font>      <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>236</font> <font color='#008800'>{&amp;igrave&#059;}</font><font color='#AA0000'>)</font>    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>237</font> <font color='#008800'>{&amp;iacute&#059;}</font><font color='#AA0000'>)</font>    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>238</font> <font color='#008800'>{&amp;icirc&#059;}</font><font color='#AA0000'>)</font>
    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>239</font> <font color='#008800'>{&amp;iuml&#059;}</font><font color='#AA0000'>)</font>      <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>240</font> <font color='#008800'>{&amp;eth&#059;}</font><font color='#AA0000'>)</font>       <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>241</font> <font color='#008800'>{&amp;ntilde&#059;}</font><font color='#AA0000'>)</font>    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>242</font> <font color='#008800'>{&amp;ograve&#059;}</font><font color='#AA0000'>)</font>
    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>243</font> <font color='#008800'>{&amp;oacute&#059;}</font><font color='#AA0000'>)</font>    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>244</font> <font color='#008800'>{&amp;ocirc&#059;}</font><font color='#AA0000'>)</font>     <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>245</font> <font color='#008800'>{&amp;otilde&#059;}</font><font color='#AA0000'>)</font>    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>246</font> <font color='#008800'>{&amp;ouml&#059;}</font><font color='#AA0000'>)</font>
    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>247</font> <font color='#008800'>{&amp;divide&#059;}</font><font color='#AA0000'>)</font>    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>248</font> <font color='#008800'>{&amp;oslash&#059;}</font><font color='#AA0000'>)</font>    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>249</font> <font color='#008800'>{&amp;ugrave&#059;}</font><font color='#AA0000'>)</font>    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>250</font> <font color='#008800'>{&amp;uacute&#059;}</font><font color='#AA0000'>)</font>
    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>251</font> <font color='#008800'>{&amp;ucirc&#059;}</font><font color='#AA0000'>)</font>     <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>252</font> <font color='#008800'>{&amp;uuml&#059;}</font><font color='#AA0000'>)</font>      <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>253</font> <font color='#008800'>{&amp;yacute&#059;}</font><font color='#AA0000'>)</font>    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>254</font> <font color='#008800'>{&amp;thorn&#059;}</font><font color='#AA0000'>)</font>
    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>255</font> <font color='#008800'>{&amp;yuml&#059;}</font><font color='#AA0000'>)</font>      <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>338</font> <font color='#008800'>{&amp;OElig&#059;}</font><font color='#AA0000'>)</font>     <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>339</font> <font color='#008800'>{&amp;oelig&#059;}</font><font color='#AA0000'>)</font>     <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>352</font> <font color='#008800'>{&amp;Scaron&#059;}</font><font color='#AA0000'>)</font>
    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>353</font> <font color='#008800'>{&amp;scaron&#059;}</font><font color='#AA0000'>)</font>    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>376</font> <font color='#008800'>{&amp;Yuml&#059;}</font><font color='#AA0000'>)</font>      <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>402</font> <font color='#008800'>{&amp;fnof&#059;}</font><font color='#AA0000'>)</font>      <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>710</font> <font color='#008800'>{&amp;circ&#059;}</font><font color='#AA0000'>)</font>
    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>732</font> <font color='#008800'>{&amp;tilde&#059;}</font><font color='#AA0000'>)</font>     <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>913</font> <font color='#008800'>{&amp;Alpha&#059;}</font><font color='#AA0000'>)</font>     <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>914</font> <font color='#008800'>{&amp;Beta&#059;}</font><font color='#AA0000'>)</font>      <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>915</font> <font color='#008800'>{&amp;Gamma&#059;}</font><font color='#AA0000'>)</font>
    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>916</font> <font color='#008800'>{&amp;Delta&#059;}</font><font color='#AA0000'>)</font>     <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>917</font> <font color='#008800'>{&amp;Epsilon&#059;}</font><font color='#AA0000'>)</font>   <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>918</font> <font color='#008800'>{&amp;Zeta&#059;}</font><font color='#AA0000'>)</font>      <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>919</font> <font color='#008800'>{&amp;Eta&#059;}</font><font color='#AA0000'>)</font>
    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>920</font> <font color='#008800'>{&amp;Theta&#059;}</font><font color='#AA0000'>)</font>     <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>921</font> <font color='#008800'>{&amp;Iota&#059;}</font><font color='#AA0000'>)</font>      <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>922</font> <font color='#008800'>{&amp;Kappa&#059;}</font><font color='#AA0000'>)</font>     <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>923</font> <font color='#008800'>{&amp;Lambda&#059;}</font><font color='#AA0000'>)</font>
    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>924</font> <font color='#008800'>{&amp;Mu&#059;}</font><font color='#AA0000'>)</font>        <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>925</font> <font color='#008800'>{&amp;Nu&#059;}</font><font color='#AA0000'>)</font>        <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>926</font> <font color='#008800'>{&amp;Xi&#059;}</font><font color='#AA0000'>)</font>        <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>927</font> <font color='#008800'>{&amp;Omicron&#059;}</font><font color='#AA0000'>)</font>
    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>928</font> <font color='#008800'>{&amp;Pi&#059;}</font><font color='#AA0000'>)</font>        <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>929</font> <font color='#008800'>{&amp;Rho&#059;}</font><font color='#AA0000'>)</font>       <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>931</font> <font color='#008800'>{&amp;Sigma&#059;}</font><font color='#AA0000'>)</font>     <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>932</font> <font color='#008800'>{&amp;Tau&#059;}</font><font color='#AA0000'>)</font>
    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>933</font> <font color='#008800'>{&amp;Upsilon&#059;}</font><font color='#AA0000'>)</font>   <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>934</font> <font color='#008800'>{&amp;Phi&#059;}</font><font color='#AA0000'>)</font>       <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>935</font> <font color='#008800'>{&amp;Chi&#059;}</font><font color='#AA0000'>)</font>       <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>936</font> <font color='#008800'>{&amp;Psi&#059;}</font><font color='#AA0000'>)</font>
    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>937</font> <font color='#008800'>{&amp;Omega&#059;}</font><font color='#AA0000'>)</font>     <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>945</font> <font color='#008800'>{&amp;alpha&#059;}</font><font color='#AA0000'>)</font>     <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>946</font> <font color='#008800'>{&amp;beta&#059;}</font><font color='#AA0000'>)</font>      <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>947</font> <font color='#008800'>{&amp;gamma&#059;}</font><font color='#AA0000'>)</font>
    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>948</font> <font color='#008800'>{&amp;delta&#059;}</font><font color='#AA0000'>)</font>     <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>949</font> <font color='#008800'>{&amp;epsilon&#059;}</font><font color='#AA0000'>)</font>   <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>950</font> <font color='#008800'>{&amp;zeta&#059;}</font><font color='#AA0000'>)</font>      <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>951</font> <font color='#008800'>{&amp;eta&#059;}</font><font color='#AA0000'>)</font>
    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>952</font> <font color='#008800'>{&amp;theta&#059;}</font><font color='#AA0000'>)</font>     <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>953</font> <font color='#008800'>{&amp;iota&#059;}</font><font color='#AA0000'>)</font>      <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>954</font> <font color='#008800'>{&amp;kappa&#059;}</font><font color='#AA0000'>)</font>     <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>955</font> <font color='#008800'>{&amp;lambda&#059;}</font><font color='#AA0000'>)</font>
    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>956</font> <font color='#008800'>{&amp;mu&#059;}</font><font color='#AA0000'>)</font>        <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>957</font> <font color='#008800'>{&amp;nu&#059;}</font><font color='#AA0000'>)</font>        <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>958</font> <font color='#008800'>{&amp;xi&#059;}</font><font color='#AA0000'>)</font>        <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>959</font> <font color='#008800'>{&amp;omicron&#059;}</font><font color='#AA0000'>)</font>
    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>960</font> <font color='#008800'>{&amp;pi&#059;}</font><font color='#AA0000'>)</font>        <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>961</font> <font color='#008800'>{&amp;rho&#059;}</font><font color='#AA0000'>)</font>       <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>962</font> <font color='#008800'>{&amp;sigmaf&#059;}</font><font color='#AA0000'>)</font>    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>963</font> <font color='#008800'>{&amp;sigma&#059;}</font><font color='#AA0000'>)</font>
    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>964</font> <font color='#008800'>{&amp;tau&#059;}</font><font color='#AA0000'>)</font>       <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>965</font> <font color='#008800'>{&amp;upsilon&#059;}</font><font color='#AA0000'>)</font>   <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>966</font> <font color='#008800'>{&amp;phi&#059;}</font><font color='#AA0000'>)</font>       <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>967</font> <font color='#008800'>{&amp;chi&#059;}</font><font color='#AA0000'>)</font>
    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>968</font> <font color='#008800'>{&amp;psi&#059;}</font><font color='#AA0000'>)</font>       <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>969</font> <font color='#008800'>{&amp;omega&#059;}</font><font color='#AA0000'>)</font>     <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>977</font> <font color='#008800'>{&amp;thetasym&#059;}</font><font color='#AA0000'>)</font>  <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>978</font> <font color='#008800'>{&amp;upsih&#059;}</font><font color='#AA0000'>)</font>
    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>982</font> <font color='#008800'>{&amp;piv&#059;}</font><font color='#AA0000'>)</font>       <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>8194</font> <font color='#008800'>{&amp;ensp&#059;}</font><font color='#AA0000'>)</font>     <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>8195</font> <font color='#008800'>{&amp;emsp&#059;}</font><font color='#AA0000'>)</font>     <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>8201</font> <font color='#008800'>{&amp;thinsp&#059;}</font><font color='#AA0000'>)</font>
    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>8204</font> <font color='#008800'>{&amp;zwnj&#059;}</font><font color='#AA0000'>)</font>     <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>8204</font> <font color='#008800'>{&amp;zwj&#059;}</font><font color='#AA0000'>)</font>      <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>8204</font> <font color='#008800'>{&amp;lrm&#059;}</font><font color='#AA0000'>)</font>      <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>8204</font> <font color='#008800'>{&amp;rlm&#059;}</font><font color='#AA0000'>)</font>
    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>8211</font> <font color='#008800'>{&amp;ndash&#059;}</font><font color='#AA0000'>)</font>    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>8212</font> <font color='#008800'>{&amp;mdash&#059;}</font><font color='#AA0000'>)</font>    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>8216</font> <font color='#008800'>{&amp;lsquo&#059;}</font><font color='#AA0000'>)</font>    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>8217</font> <font color='#008800'>{&amp;rsquo&#059;}</font><font color='#AA0000'>)</font>
    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>8218</font> <font color='#008800'>{&amp;sbquo&#059;}</font><font color='#AA0000'>)</font>    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>8220</font> <font color='#008800'>{&amp;ldquo&#059;}</font><font color='#AA0000'>)</font>    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>8221</font> <font color='#008800'>{&amp;rdquo&#059;}</font><font color='#AA0000'>)</font>    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>8222</font> <font color='#008800'>{&amp;bdquo&#059;}</font><font color='#AA0000'>)</font>
    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>8224</font> <font color='#008800'>{&amp;dagger&#059;}</font><font color='#AA0000'>)</font>   <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>8225</font> <font color='#008800'>{&amp;Dagger&#059;}</font><font color='#AA0000'>)</font>   <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>8226</font> <font color='#008800'>{&amp;bull&#059;}</font><font color='#AA0000'>)</font>     <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>8230</font> <font color='#008800'>{&amp;hellip&#059;}</font><font color='#AA0000'>)</font>
    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>8240</font> <font color='#008800'>{&amp;permil&#059;}</font><font color='#AA0000'>)</font>   <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>8242</font> <font color='#008800'>{&amp;prime&#059;}</font><font color='#AA0000'>)</font>    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>8243</font> <font color='#008800'>{&amp;Prime&#059;}</font><font color='#AA0000'>)</font>    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>8249</font> <font color='#008800'>{&amp;lsaquo&#059;}</font><font color='#AA0000'>)</font>
    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>8250</font> <font color='#008800'>{&amp;rsaquo&#059;}</font><font color='#AA0000'>)</font>   <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>8254</font> <font color='#008800'>{&amp;oline&#059;}</font><font color='#AA0000'>)</font>    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>8260</font> <font color='#008800'>{&amp;frasl&#059;}</font><font color='#AA0000'>)</font>    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>8364</font> <font color='#008800'>{&amp;euro&#059;}</font><font color='#AA0000'>)</font>
    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>8465</font> <font color='#008800'>{&amp;image&#059;}</font><font color='#AA0000'>)</font>    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>8472</font> <font color='#008800'>{&amp;weierp&#059;}</font><font color='#AA0000'>)</font>   <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>8476</font> <font color='#008800'>{&amp;real&#059;}</font><font color='#AA0000'>)</font>     <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>8482</font> <font color='#008800'>{&amp;trade&#059;}</font><font color='#AA0000'>)</font>
    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>8501</font> <font color='#008800'>{&amp;alefsym&#059;}</font><font color='#AA0000'>)</font>  <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>8592</font> <font color='#008800'>{&amp;larr&#059;}</font><font color='#AA0000'>)</font>     <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>8593</font> <font color='#008800'>{&amp;uarr&#059;}</font><font color='#AA0000'>)</font>     <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>8594</font> <font color='#008800'>{&amp;rarr&#059;}</font><font color='#AA0000'>)</font>
    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>8595</font> <font color='#008800'>{&amp;darr&#059;}</font><font color='#AA0000'>)</font>     <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>8596</font> <font color='#008800'>{&amp;harr&#059;}</font><font color='#AA0000'>)</font>     <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>8629</font> <font color='#008800'>{&amp;crarr&#059;}</font><font color='#AA0000'>)</font>    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>8656</font> <font color='#008800'>{&amp;lArr&#059;}</font><font color='#AA0000'>)</font>
    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>8657</font> <font color='#008800'>{&amp;uArr&#059;}</font><font color='#AA0000'>)</font>     <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>8658</font> <font color='#008800'>{&amp;rArr&#059;}</font><font color='#AA0000'>)</font>     <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>8659</font> <font color='#008800'>{&amp;dArr&#059;}</font><font color='#AA0000'>)</font>     <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>8660</font> <font color='#008800'>{&amp;hArr&#059;}</font><font color='#AA0000'>)</font>
    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>8704</font> <font color='#008800'>{&amp;forall&#059;}</font><font color='#AA0000'>)</font>   <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>8706</font> <font color='#008800'>{&amp;part&#059;}</font><font color='#AA0000'>)</font>     <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>8707</font> <font color='#008800'>{&amp;exist&#059;}</font><font color='#AA0000'>)</font>    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>8709</font> <font color='#008800'>{&amp;empty&#059;}</font><font color='#AA0000'>)</font>
    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>8711</font> <font color='#008800'>{&amp;nabla&#059;}</font><font color='#AA0000'>)</font>    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>8712</font> <font color='#008800'>{&amp;isin&#059;}</font><font color='#AA0000'>)</font>     <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>8713</font> <font color='#008800'>{&amp;notin&#059;}</font><font color='#AA0000'>)</font>    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>8715</font> <font color='#008800'>{&amp;ni&#059;}</font><font color='#AA0000'>)</font>
    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>8719</font> <font color='#008800'>{&amp;prod&#059;}</font><font color='#AA0000'>)</font>     <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>8721</font> <font color='#008800'>{&amp;sum&#059;}</font><font color='#AA0000'>)</font>      <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>8722</font> <font color='#008800'>{&amp;minus&#059;}</font><font color='#AA0000'>)</font>    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>8727</font> <font color='#008800'>{&amp;lowast&#059;}</font><font color='#AA0000'>)</font>
    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>8730</font> <font color='#008800'>{&amp;radic&#059;}</font><font color='#AA0000'>)</font>    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>8733</font> <font color='#008800'>{&amp;prop&#059;}</font><font color='#AA0000'>)</font>     <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>8734</font> <font color='#008800'>{&amp;infin&#059;}</font><font color='#AA0000'>)</font>    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>8736</font> <font color='#008800'>{&amp;ang&#059;}</font><font color='#AA0000'>)</font>
    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>8743</font> <font color='#008800'>{&amp;and&#059;}</font><font color='#AA0000'>)</font>      <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>8744</font> <font color='#008800'>{&amp;or&#059;}</font><font color='#AA0000'>)</font>       <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>8745</font> <font color='#008800'>{&amp;cap&#059;}</font><font color='#AA0000'>)</font>      <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>8746</font> <font color='#008800'>{&amp;cup&#059;}</font><font color='#AA0000'>)</font>
    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>8747</font> <font color='#008800'>{&amp;int&#059;}</font><font color='#AA0000'>)</font>      <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>8756</font> <font color='#008800'>{&amp;there4&#059;}</font><font color='#AA0000'>)</font>   <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>8764</font> <font color='#008800'>{&amp;sim&#059;}</font><font color='#AA0000'>)</font>      <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>8773</font> <font color='#008800'>{&amp;cong&#059;}</font><font color='#AA0000'>)</font>
    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>8776</font> <font color='#008800'>{&amp;asymp&#059;}</font><font color='#AA0000'>)</font>    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>8800</font> <font color='#008800'>{&amp;ne&#059;}</font><font color='#AA0000'>)</font>       <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>8801</font> <font color='#008800'>{&amp;equiv&#059;}</font><font color='#AA0000'>)</font>    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>8804</font> <font color='#008800'>{&amp;le&#059;}</font><font color='#AA0000'>)</font>
    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>8805</font> <font color='#008800'>{&amp;ge&#059;}</font><font color='#AA0000'>)</font>       <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>8834</font> <font color='#008800'>{&amp;sub&#059;}</font><font color='#AA0000'>)</font>      <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>8835</font> <font color='#008800'>{&amp;sup&#059;}</font><font color='#AA0000'>)</font>      <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>8836</font> <font color='#008800'>{&amp;nsub&#059;}</font><font color='#AA0000'>)</font>
    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>8838</font> <font color='#008800'>{&amp;sube&#059;}</font><font color='#AA0000'>)</font>     <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>8839</font> <font color='#008800'>{&amp;supe&#059;}</font><font color='#AA0000'>)</font>     <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>8853</font> <font color='#008800'>{&amp;oplus&#059;}</font><font color='#AA0000'>)</font>    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>8855</font> <font color='#008800'>{&amp;otimes&#059;}</font><font color='#AA0000'>)</font>
    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>8869</font> <font color='#008800'>{&amp;perp&#059;}</font><font color='#AA0000'>)</font>     <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>8901</font> <font color='#008800'>{&amp;sdot&#059;}</font><font color='#AA0000'>)</font>     <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>8968</font> <font color='#008800'>{&amp;lceil&#059;}</font><font color='#AA0000'>)</font>    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>8969</font> <font color='#008800'>{&amp;rceil&#059;}</font><font color='#AA0000'>)</font>
    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>8970</font> <font color='#008800'>{&amp;lfloor&#059;}</font><font color='#AA0000'>)</font>   <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>8971</font> <font color='#008800'>{&amp;rfloor&#059;}</font><font color='#AA0000'>)</font>   <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>9001</font> <font color='#008800'>{&amp;lang&#059;}</font><font color='#AA0000'>)</font>     <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>9002</font> <font color='#008800'>{&amp;rang&#059;}</font><font color='#AA0000'>)</font>
    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>9674</font> <font color='#008800'>{&amp;loz&#059;}</font><font color='#AA0000'>)</font>      <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>9824</font> <font color='#008800'>{&amp;spades&#059;}</font><font color='#AA0000'>)</font>   <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>9827</font> <font color='#008800'>{&amp;clubs&#059;}</font><font color='#AA0000'>)</font>    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>9829</font> <font color='#008800'>{&amp;hearts&#059;}</font><font color='#AA0000'>)</font>
    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#665500'>9830</font> <font color='#008800'>{&amp;diams&#059;}</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>

<font color='#AA0000'>(</font><font color='#0000AA'>define</font> UNENTITIES
  <font color='#AA0000'>(</font><font color='#0000AA'>map</font> <font color='#0000AA'>reverse</font> ENTITIES<font color='#AA0000'>)</font><font color='#AA0000'>)</font>

<font color='#AA0000'>(</font><font color='#0000AA'>define</font> JS_ESCAPE_CHARS
  <font color='#AA0000'>(</font><font color='#0000AA'>list</font>
    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#008800'>{\}</font> <font color='#008800'>{\\}</font><font color='#AA0000'>)</font>
    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#008800'>{&#034;}</font> <font color='#008800'>{&#092;&#034;}</font><font color='#AA0000'>)</font>
    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#008800'>{'}</font> <font color='#008800'>{\'}</font><font color='#AA0000'>)</font>
    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#008800'>"&#092;n"</font> <font color='#008800'>{\n}</font><font color='#AA0000'>)</font>
    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#008800'>"&#092;r"</font> <font color='#008800'>{\r}</font><font color='#AA0000'>)</font>
    <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#008800'>"&lt;/"</font> <font color='#008800'>{<\/}</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>

<font color='#555555'>;; <font color='#308080'>@syntax</font> (Web:escape-js &lt;str&gt;)</font>
<font color='#555555'>;; <font color='#308080'>@param</font> &lt;str&gt; a string to escape</font>
<font color='#555555'>;; &lt;p&gt;Escapes a string for output in javascript. Does not encode entities;</font>
<font color='#555555'>;; just prevents control characters from causing syntax errors in javascript.&lt;/p&gt;</font>
<font color='#AA0000'>(</font><font color='#0000AA'>define</font> <font color='#AA0000'>(</font>escape-js str<font color='#AA0000'>)</font>
  <font color='#AA0000'>(</font><font color='#0000AA'>dolist</font> <font color='#AA0000'>(</font>ch JS_ESCAPE_CHARS<font color='#AA0000'>)</font>
    <font color='#AA0000'>(</font><font color='#0000AA'>replace</font> <font color='#AA0000'>(</font><font color='#0000AA'>first</font> ch<font color='#AA0000'>)</font> str <font color='#AA0000'>(</font><font color='#0000AA'>last</font> ch<font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>
  str<font color='#AA0000'>)</font>

<font color='#555555'>;; <font color='#308080'>@syntax</font> (Web:escape &lt;str&gt;)</font>
<font color='#555555'>;; <font color='#308080'>@param</font> &lt;str&gt; a string to escape</font>
<font color='#555555'>;; <font color='#308080'>@return</font> the escaped string</font>
<font color='#555555'>;; &lt;p&gt;Escapes characters that are part of the (X)HTML and XML syntax to prevent</font>
<font color='#555555'>;; characters from confusing browsers' parsing of markup. Escapes single and</font>
<font color='#555555'>;; double quotes, ampersands, and left and right angle brackets</font>
<font color='#555555'>;; ('&amp;quot;', '&amp;apos;', '&amp;amp;', '&amp;lt;', and '&amp;gt;').&lt;/p&gt;</font>
<font color='#AA0000'>(</font><font color='#0000AA'>define</font> <font color='#AA0000'>(</font>escape str<font color='#AA0000'>)</font>
  <font color='#AA0000'>(</font><font color='#0000AA'>replace</font> <font color='#008800'>{&#034;}</font> str <font color='#008800'>{&amp;quot&#059;}</font><font color='#AA0000'>)</font>
  <font color='#AA0000'>(</font><font color='#0000AA'>replace</font> <font color='#008800'>{'}</font> str <font color='#008800'>{&amp;apos&#059;}</font><font color='#AA0000'>)</font>
  <font color='#AA0000'>(</font><font color='#0000AA'>replace</font> <font color='#008800'>{&amp;}</font> str <font color='#008800'>{&amp;amp&#059;}</font><font color='#AA0000'>)</font>
  <font color='#AA0000'>(</font><font color='#0000AA'>replace</font> <font color='#008800'>{<}</font> str <font color='#008800'>{&amp;lt&#059;}</font><font color='#AA0000'>)</font>
  <font color='#AA0000'>(</font><font color='#0000AA'>replace</font> <font color='#008800'>{>}</font> str <font color='#008800'>{&amp;gt&#059;}</font><font color='#AA0000'>)</font>
  str<font color='#AA0000'>)</font>

<font color='#555555'>;; <font color='#308080'>@syntax</font> (Web:unescape &lt;str&gt;)</font>
<font color='#555555'>;; <font color='#308080'>@param</font> &lt;str&gt; an entity-escaped string</font>
<font color='#555555'>;; <font color='#308080'>@return</font> the unescaped string</font>
<font color='#555555'>;; &lt;p&gt;Unescapes the basic (X)HTML and XML character entities in a string.&lt;/p&gt;</font>
<font color='#AA0000'>(</font><font color='#0000AA'>define</font> <font color='#AA0000'>(</font>unescape str<font color='#AA0000'>)</font>
  <font color='#AA0000'>(</font><font color='#0000AA'>replace</font> <font color='#008800'>{&amp;quot&#059;}</font> str <font color='#008800'>{&#034;}</font><font color='#AA0000'>)</font>
  <font color='#AA0000'>(</font><font color='#0000AA'>replace</font> <font color='#008800'>{&amp;apos&#059;}</font> str <font color='#008800'>{'}</font><font color='#AA0000'>)</font>
  <font color='#AA0000'>(</font><font color='#0000AA'>replace</font> <font color='#008800'>{&amp;amp&#059;}</font> str <font color='#008800'>{&amp;}</font><font color='#AA0000'>)</font>
  <font color='#AA0000'>(</font><font color='#0000AA'>replace</font> <font color='#008800'>{&amp;lt&#059;}</font> str <font color='#008800'>{<}</font><font color='#AA0000'>)</font>
  <font color='#AA0000'>(</font><font color='#0000AA'>replace</font> <font color='#008800'>{&amp;gt&#059;}</font> str <font color='#008800'>{>}</font><font color='#AA0000'>)</font>
  str<font color='#AA0000'>)</font>

<font color='#555555'>;; <font color='#308080'>@syntax</font> (Web:encode-entities &lt;str&gt;)</font>
<font color='#555555'>;; <font color='#308080'>@param</font> &lt;str&gt; a string to escape</font>
<font color='#555555'>;; <font color='#308080'>@return</font> the escaped string</font>
<font color='#555555'>;; &lt;p&gt;Escapes characters with a much larger set of character entities than</font>
<font color='#555555'>;; 'escape' using a table derived from </font>
<font color='#555555'>;; <font color='#308080'>@link</font> http://en.wikipedia.org/wiki/List_of_XML_and_HTML_character_entity_references Wikipedia.</font>
<font color='#AA0000'>(</font><font color='#0000AA'>define</font> <font color='#AA0000'>(</font>encode-entities str , ent <font color='#AA0000'>(</font>buf <font color='#008800'>""</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>
  <font color='#AA0000'>(</font><font color='#0000AA'>dostring</font> <font color='#AA0000'>(</font>c str<font color='#AA0000'>)</font>
    <font color='#AA0000'>(</font><font color='#0000AA'>write-buffer</font> buf
      <font color='#AA0000'>(</font><font color='#0000AA'>if</font> <font color='#AA0000'>(</font><font color='#0000AA'>setf</font> ent <font color='#AA0000'>(</font><font color='#0000AA'>lookup</font> c ENTITIES<font color='#AA0000'>)</font><font color='#AA0000'>)</font> ent <font color='#AA0000'>(</font><font color='#0000AA'>char</font> c<font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>
  buf<font color='#AA0000'>)</font>

<font color='#555555'>;; <font color='#308080'>@syntax</font> (Web:decode-entities &lt;str&gt;)</font>
<font color='#555555'>;; <font color='#308080'>@param</font> &lt;str&gt; an entity-encoded string</font>
<font color='#555555'>;; <font color='#308080'>@return</font> the decoded string</font>
<font color='#555555'>;; &lt;p&gt;Translates character entities to their character equivalents as well as</font>
<font color='#555555'>;; numeric entities.&lt;/p&gt;</font>
<font color='#AA0000'>(</font><font color='#0000AA'>define</font> <font color='#AA0000'>(</font>decode-entities str<font color='#AA0000'>)</font>
  <font color='#AA0000'>(</font><font color='#0000AA'>replace</font> <font color='#008800'>{&amp;(\d+)&#059;}</font> str <font color='#AA0000'>(</font><font color='#0000AA'>char</font> <font color='#AA0000'>(</font><font color='#0000AA'>int</font> $1<font color='#AA0000'>)</font><font color='#AA0000'>)</font> <font color='#665500'>0</font><font color='#AA0000'>)</font>
  <font color='#AA0000'>(</font><font color='#0000AA'>replace</font> <font color='#008800'>{(&amp;\S+?&#059;)}</font> str <font color='#AA0000'>(</font><font color='#0000AA'>char</font> <font color='#AA0000'>(</font><font color='#0000AA'>lookup</font> $1 UNENTITIES<font color='#AA0000'>)</font><font color='#AA0000'>)</font> <font color='#665500'>0</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>

<font color='#555555'>; Translates a single character into a hex-encoded string suitable for a URL.</font>
<font color='#AA0000'>(</font><font color='#0000AA'>define</font> <font color='#AA0000'>(</font>hex-encode-char ch<font color='#AA0000'>)</font>
  <font color='#AA0000'>(</font><font color='#0000AA'>if</font> <font color='#AA0000'>(</font><font color='#0000AA'>=</font> <font color='#008800'>" "</font> ch<font color='#AA0000'>)</font> <font color='#008800'>"+"</font> <font color='#AA0000'>(</font><font color='#0000AA'>format</font> <font color='#008800'>"%%%x"</font> <font color='#AA0000'>(</font><font color='#0000AA'>char</font> ch<font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>

<font color='#555555'>; Translates a URL-encoded hex into a string character.</font>
<font color='#AA0000'>(</font><font color='#0000AA'>define</font> <font color='#AA0000'>(</font>hex-decode-char ch<font color='#AA0000'>)</font>
  <font color='#AA0000'>(</font><font color='#0000AA'>when</font> <font color='#AA0000'>(</font><font color='#0000AA'>starts-with</font> ch <font color='#008800'>"%"</font><font color='#AA0000'>)</font>
    <font color='#AA0000'>(</font><font color='#0000AA'>pop</font> ch<font color='#AA0000'>)</font><font color='#AA0000'>)</font>
  <font color='#AA0000'>(</font><font color='#0000AA'>char</font> <font color='#AA0000'>(</font><font color='#0000AA'>int</font> <font color='#AA0000'>(</font><font color='#0000AA'>append</font> <font color='#008800'>"0x"</font> $1<font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>

<font color='#555555'>;; <font color='#308080'>@syntax</font> (Web:url-encode &lt;str&gt;)</font>
<font color='#555555'>;; <font color='#308080'>@param</font> &lt;str&gt; a string token to encode for use in a URL</font>
<font color='#555555'>;; <font color='#308080'>@return</font> the URL-encoded string</font>
<font color='#555555'>;; &lt;p&gt;Encodes a string for use in a URL.&lt;/p&gt;</font>
<font color='#AA0000'>(</font><font color='#0000AA'>constant</font> 'REGEX_HTTP_SPECIAL_CHAR <font color='#AA0000'>(</font><font color='#0000AA'>regex-comp</font> <font color='#008800'>{([^-_.$+!*'()0-9a-z])}</font> <font color='#665500'>1</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>

<font color='#AA0000'>(</font><font color='#0000AA'>define</font> <font color='#AA0000'>(</font>url-encode str<font color='#AA0000'>)</font>
  <font color='#AA0000'>(</font><font color='#0000AA'>replace</font> <font color='#008800'>" "</font> str <font color='#008800'>"+"</font><font color='#AA0000'>)</font>
  <font color='#AA0000'>(</font><font color='#0000AA'>replace</font> REGEX_HTTP_SPECIAL_CHAR str <font color='#AA0000'>(</font>hex-encode-char $1<font color='#AA0000'>)</font> <font color='#665500'>0x10000</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>

<font color='#555555'>;; <font color='#308080'>@syntax</font> (Web:url-decode &lt;str&gt;)</font>
<font color='#555555'>;; <font color='#308080'>@param</font> &lt;str&gt; a URL-encoded string</font>
<font color='#555555'>;; <font color='#308080'>@return</font> the decoded string</font>
<font color='#555555'>;; &lt;p&gt;Decodes hexidecimals and spaces (represented as '+') in a URL-encoded string.&lt;/p&gt;</font>
<font color='#AA0000'>(</font><font color='#0000AA'>constant</font> 'REGEX_HEX_ENCODED_CHAR <font color='#AA0000'>(</font><font color='#0000AA'>regex-comp</font> <font color='#008800'>{%([0-9A-F][0-9A-F])}</font> <font color='#665500'>1</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>

<font color='#AA0000'>(</font><font color='#0000AA'>define</font> <font color='#AA0000'>(</font>url-decode str<font color='#AA0000'>)</font>
  <font color='#AA0000'>(</font><font color='#0000AA'>replace</font> <font color='#008800'>"+"</font> str <font color='#008800'>" "</font><font color='#AA0000'>)</font>
  <font color='#AA0000'>(</font><font color='#0000AA'>replace</font> REGEX_HEX_ENCODED_CHAR str <font color='#AA0000'>(</font>hex-decode-char $1<font color='#AA0000'>)</font> <font color='#665500'>0x10000</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>

<font color='#555555'>;; <font color='#308080'>@syntax</font> (Web:parse-query &lt;query-string&gt;)</font>
<font color='#555555'>;; <font color='#308080'>@param</font> &lt;query-string&gt; a URL-encoded query string</font>
<font color='#555555'>;; <font color='#308080'>@return</font> an association list of decoded key-value pairs</font>
<font color='#555555'>;; &lt;p&gt;Parses a URL-encoded query string and returns a list of key-values pairs.&lt;/p&gt;</font>
<font color='#AA0000'>(</font><font color='#0000AA'>constant</font> 'REGEX_QUERY <font color='#AA0000'>(</font><font color='#0000AA'>regex-comp</font> <font color='#008800'>{&amp;([^&amp;=]+?)=([^&amp;=]+?)(?=&amp;|$)}</font> <font color='#665500'>1</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>

<font color='#AA0000'>(</font><font color='#0000AA'>define</font> <font color='#AA0000'>(</font>parse-query query<font color='#AA0000'>)</font>
  <font color='#AA0000'>(</font><font color='#0000AA'>when</font> <font color='#AA0000'>(</font><font color='#0000AA'>starts-with</font> query <font color='#008800'>"?"</font><font color='#AA0000'>)</font>
    <font color='#AA0000'>(</font><font color='#0000AA'>pop</font> query<font color='#AA0000'>)</font><font color='#AA0000'>)</font>
  <font color='#AA0000'>(</font><font color='#0000AA'>push</font> <font color='#008800'>"&amp;"</font> query<font color='#AA0000'>)</font>
  <font color='#AA0000'>(</font><font color='#0000AA'>find-all</font> REGEX_QUERY query <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#AA0000'>(</font>url-decode $1<font color='#AA0000'>)</font> <font color='#AA0000'>(</font>url-decode $2<font color='#AA0000'>)</font><font color='#AA0000'>)</font> <font color='#665500'>0x10000</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>

<font color='#555555'>;; <font color='#308080'>@syntax</font> (Web:build-query &lt;a-list&gt;)</font>
<font color='#555555'>;; <font color='#308080'>@param</font> &lt;a-list&gt; an association list</font>
<font color='#555555'>;; <font color='#308080'>@return</font> a URL-encoded query string</font>
<font color='#555555'>;; &lt;p&gt;Builds a URL-encoded query string using &lt;a-list&gt;. Does not include the leading</font>
<font color='#555555'>;; question mark (so queries may be easily built of association list fragments.)&lt;/p&gt;</font>
<font color='#AA0000'>(</font><font color='#0000AA'>define</font> <font color='#AA0000'>(</font>build-query alist , query<font color='#AA0000'>)</font>
  <font color='#AA0000'>(</font><font color='#0000AA'>join</font> <font color='#AA0000'>(</font><font color='#0000AA'>map</font> <font color='#AA0000'>(</font>fn <font color='#AA0000'>(</font>pair<font color='#AA0000'>)</font> <font color='#AA0000'>(</font><font color='#0000AA'>join</font> <font color='#AA0000'>(</font><font color='#0000AA'>map</font> url-encode pair<font color='#AA0000'>)</font> <font color='#008800'>"="</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font> alist<font color='#AA0000'>)</font> <font color='#008800'>"&amp;"</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>

<font color='#555555'>;; <font color='#308080'>@syntax</font> (Web:parse-url &lt;str-url&gt;)</font>
<font color='#555555'>;; <font color='#308080'>@param</font> &lt;str-url&gt; a URL</font>
<font color='#555555'>;; <font color='#308080'>@return</font> an association list with the decomposed URL's parts</font>
<font color='#555555'>;; &lt;p&gt;Parses a URL and returns an association list of its decomposed parts. The list's</font>
<font color='#555555'>;; keys (as strings) are: scheme, user, pass, host, port, path, query, and fragment.</font>
<font color='#555555'>;; Also handles IPV6 addresses. Modeled on the PHP function of the same name.&lt;/p&gt;</font>
<font color='#555555'>;; </font>
<font color='#555555'>;; Parsing based on code from <font color='#308080'>@link</font> http://us3.php.net/manual/en/function.parse-url.php#90365 this&amp;nbsp;comment.</font>
<font color='#AA0000'>(</font><font color='#0000AA'>constant</font> 'REGEX_URL
  <font color='#AA0000'>(</font><font color='#0000AA'>regex-comp</font>
    <font color='#008800'>[text]
      (?:([a-z0-9+-._]+)://)?
      (?:
        (?:((?:[a-z0-9-._~!$&amp;'()*+,&#059;=:]|%[0-9a-f]{2})*)@)?
        (?:\[((?:[a-z0-9:])*)\])?
        ((?:[a-z0-9-._~!$&amp;'()*+,&#059;=]|%[0-9a-f]{2})*)
        (?::(\d*))?
        (/(?:[a-z0-9-._~!$&amp;'()*+,&#059;=:@/]|%[0-9a-f]{2})*)?
        |
        (/?
          (?:[a-z0-9-._~!$&amp;'()*+,&#059;=:@]|%[0-9a-f]{2})+
          (?:[a-z0-9-._~!$&amp;'()*+,&#059;=:@/]|%[0-9a-f]{2})*
        )?
      )
      (?:\?((?:[a-z0-9-._~!$&amp;'()*+,&#059;=:/?@]|%[0-9a-f]{2})*))?
      (?:\#((?:[a-z0-9-._~!$&amp;'()*+,&#059;=:/?@]|%[0-9a-f]{2})*))?
    [/text]</font>
    <font color='#AA0000'>(</font><font color='#0000AA'>|</font> <font color='#665500'>1</font> <font color='#665500'>8</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>

<font color='#AA0000'>(</font><font color='#0000AA'>define</font> <font color='#AA0000'>(</font>parse-url url<font color='#AA0000'>)</font>
  <font color='#555555'>;; clear indices of previous matches</font>
  <font color='#AA0000'>(</font><font color='#0000AA'>dolist</font> <font color='#AA0000'>(</font>idx '<font color='#AA0000'>(</font>$0 $1 $2 $3 $4 $5 $6 $7 $8 $9<font color='#AA0000'>)</font><font color='#AA0000'>)</font>
    <font color='#AA0000'>(</font><font color='#0000AA'>set</font> idx <font color='#0000AA'>nil</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>
  <font color='#AA0000'>(</font><font color='#0000AA'>when</font> <font color='#AA0000'>(</font><font color='#0000AA'>regex</font> REGEX_URL url <font color='#665500'>0x10000</font><font color='#AA0000'>)</font>
    <font color='#AA0000'>(</font><font color='#0000AA'>let</font> <font color='#AA0000'>(</font><font color='#AA0000'>(</font>user-pass <font color='#AA0000'>(</font><font color='#0000AA'>parse</font> $2 <font color='#008800'>":"</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>
      <font color='#AA0000'>(</font><font color='#0000AA'>list</font>
        <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#008800'>"scheme"</font> <font color='#AA0000'>(</font><font color='#0000AA'>if</font> <font color='#AA0000'>(</font><font color='#0000AA'>null?</font> $1<font color='#AA0000'>)</font> <font color='#008800'>"http"</font> $1<font color='#AA0000'>)</font><font color='#AA0000'>)</font>
        <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#008800'>"user"</font> <font color='#AA0000'>(</font><font color='#0000AA'>when</font> user-pass <font color='#AA0000'>(</font><font color='#0000AA'>first</font> user-pass<font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>
        <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#008800'>"pass"</font> <font color='#AA0000'>(</font><font color='#0000AA'>when</font> <font color='#AA0000'>(</font><font color='#0000AA'>and</font> user-pass <font color='#AA0000'>(</font><font color='#0000AA'>=</font> <font color='#AA0000'>(</font><font color='#0000AA'>length</font> user-pass<font color='#AA0000'>)</font> <font color='#665500'>2</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font> <font color='#AA0000'>(</font><font color='#0000AA'>last</font> user-pass<font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>
        <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#008800'>"host"</font> <font color='#AA0000'>(</font><font color='#0000AA'>if-not</font> <font color='#AA0000'>(</font><font color='#0000AA'>null?</font> $3<font color='#AA0000'>)</font> $3 $4<font color='#AA0000'>)</font><font color='#AA0000'>)</font>
        <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#008800'>"port"</font> <font color='#AA0000'>(</font><font color='#0000AA'>if</font> <font color='#AA0000'>(</font><font color='#0000AA'>null?</font> $5<font color='#AA0000'>)</font> <font color='#0000AA'>nil</font> $5<font color='#AA0000'>)</font><font color='#AA0000'>)</font>
        <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#008800'>"path"</font> <font color='#AA0000'>(</font><font color='#0000AA'>if</font> <font color='#AA0000'>(</font><font color='#0000AA'>and</font> <font color='#AA0000'>(</font><font color='#0000AA'>null?</font> $6<font color='#AA0000'>)</font> <font color='#AA0000'>(</font><font color='#0000AA'>null?</font> $7<font color='#AA0000'>)</font><font color='#AA0000'>)</font> <font color='#008800'>"/"</font> <font color='#AA0000'>(</font><font color='#0000AA'>string</font> $6 $7<font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>
        <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#008800'>"query"</font> <font color='#AA0000'>(</font><font color='#0000AA'>if</font> <font color='#AA0000'>(</font><font color='#0000AA'>null?</font> $8<font color='#AA0000'>)</font> <font color='#0000AA'>nil</font> $8<font color='#AA0000'>)</font><font color='#AA0000'>)</font>
        <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#008800'>"fragment"</font> <font color='#AA0000'>(</font><font color='#0000AA'>if</font> <font color='#AA0000'>(</font><font color='#0000AA'>null?</font> $9<font color='#AA0000'>)</font> <font color='#0000AA'>nil</font> $9<font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>

<font color='#555555'>;; <font color='#308080'>@syntax</font> (Web:build-url &lt;str-url&gt; [&lt;list-query-params&gt; ...])</font>
<font color='#555555'>;; <font color='#308080'>@param</font> &lt;str-url&gt; a string URL</font>
<font color='#555555'>;; <font color='#308080'>@param</font> &lt;list-query-params&gt; one or more association lists of query parameters and their values</font>
<font color='#555555'>;; </font>
<font color='#555555'>;; <font color='#308080'>@syntax</font> (Web:build-url &lt;list-url&gt; [&lt;list-query-params&gt; ...])</font>
<font color='#555555'>;; <font color='#308080'>@param</font> &lt;list-url&gt; an association list of URL components using the structure of &lt;parse-url&gt;'s return value</font>
<font color='#555555'>;; <font color='#308080'>@param</font> &lt;list-query-params&gt; one or more association lists of query parameters and their values</font>
<font color='#555555'>;; <font color='#308080'>@return</font> a URL string composed of the initial URL data plus subsequently superseding query parameters</font>
<font color='#555555'>;; &lt;p&gt;In the first syntax, builds a URL from an existing URL string.</font>
<font color='#555555'>;; In the second syntax, builds a URL from an association list in the same</font>
<font color='#555555'>;; format as the return value of &lt;parse-url&gt;, with both keys and values being</font>
<font color='#555555'>;; strings. In both syntaxes, any number of additional association lists of</font>
<font color='#555555'>;; key/value pairs may be passed, which are serialized as query parameters, with</font>
<font color='#555555'>;; each list overriding the previous. If there are query parameters in the</font>
<font color='#555555'>;; initial URL, they are used as the initial list with the lowest priority.&lt;/p&gt;</font>
<font color='#AA0000'>(</font><font color='#0000AA'>define</font> <font color='#AA0000'>(</font>build-url url<font color='#AA0000'>)</font>
  <font color='#AA0000'>(</font><font color='#0000AA'>when</font> <font color='#AA0000'>(</font><font color='#0000AA'>string?</font> url<font color='#AA0000'>)</font>
    <font color='#AA0000'>(</font><font color='#0000AA'>setf</font> url <font color='#AA0000'>(</font>parse-url url<font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>

  <font color='#AA0000'>(</font><font color='#0000AA'>local</font> <font color='#AA0000'>(</font>params<font color='#AA0000'>)</font>
    <font color='#555555'>;; Build parameter list</font>
    <font color='#AA0000'>(</font><font color='#0000AA'>setf</font> params '<font color='#AA0000'>(</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>
    <font color='#AA0000'>(</font><font color='#0000AA'>dolist</font> <font color='#AA0000'>(</font>pairs <font color='#AA0000'>(</font><font color='#0000AA'>cons</font> <font color='#AA0000'>(</font><font color='#0000AA'>lookup</font> <font color='#008800'>"query"</font> url<font color='#AA0000'>)</font> <font color='#AA0000'>(</font><font color='#0000AA'>args</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>
      <font color='#AA0000'>(</font><font color='#0000AA'>when</font> <font color='#AA0000'>(</font><font color='#0000AA'>string?</font> pairs<font color='#AA0000'>)</font> <font color='#AA0000'>(</font><font color='#0000AA'>setf</font> pairs <font color='#AA0000'>(</font>parse-query pairs<font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>
      <font color='#AA0000'>(</font><font color='#0000AA'>dolist</font> <font color='#AA0000'>(</font>pair pairs<font color='#AA0000'>)</font>
        <font color='#AA0000'>(</font><font color='#0000AA'>if</font> <font color='#AA0000'>(</font><font color='#0000AA'>assoc</font> <font color='#AA0000'>(</font><font color='#0000AA'>first</font> pair<font color='#AA0000'>)</font> params<font color='#AA0000'>)</font>
          <font color='#AA0000'>(</font><font color='#0000AA'>setf</font> <font color='#AA0000'>(</font><font color='#0000AA'>assoc</font> <font color='#AA0000'>(</font><font color='#0000AA'>first</font> pair<font color='#AA0000'>)</font> params<font color='#AA0000'>)</font> pair<font color='#AA0000'>)</font>
          <font color='#AA0000'>(</font><font color='#0000AA'>push</font> pair params<font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>
    
    <font color='#AA0000'>(</font><font color='#0000AA'>format</font> <font color='#008800'>"%s://%s%s%s%s%s%s"</font>
      <font color='#AA0000'>(</font><font color='#0000AA'>or</font> <font color='#AA0000'>(</font><font color='#0000AA'>lookup</font> <font color='#008800'>"scheme"</font> url<font color='#AA0000'>)</font> <font color='#008800'>"http"</font><font color='#AA0000'>)</font>
      <font color='#AA0000'>(</font><font color='#0000AA'>cond</font>
        <font color='#AA0000'>(</font><font color='#AA0000'>(</font><font color='#0000AA'>and</font> <font color='#AA0000'>(</font><font color='#0000AA'>lookup</font> <font color='#008800'>"user"</font> url<font color='#AA0000'>)</font> <font color='#AA0000'>(</font><font color='#0000AA'>lookup</font> <font color='#008800'>"pass"</font> url<font color='#AA0000'>)</font><font color='#AA0000'>)</font>
         <font color='#AA0000'>(</font><font color='#0000AA'>string</font> <font color='#AA0000'>(</font><font color='#0000AA'>lookup</font> <font color='#008800'>"user"</font> url<font color='#AA0000'>)</font> <font color='#008800'>":"</font> <font color='#AA0000'>(</font><font color='#0000AA'>lookup</font> <font color='#008800'>"pass"</font> url<font color='#AA0000'>)</font> <font color='#008800'>"@"</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>
        <font color='#AA0000'>(</font><font color='#AA0000'>(</font><font color='#0000AA'>lookup</font> <font color='#008800'>"user"</font> url<font color='#AA0000'>)</font>
         <font color='#AA0000'>(</font><font color='#0000AA'>string</font> <font color='#AA0000'>(</font><font color='#0000AA'>lookup</font> <font color='#008800'>"user"</font> url<font color='#AA0000'>)</font> <font color='#008800'>"@"</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>
        <font color='#AA0000'>(</font><font color='#0000AA'>true</font> <font color='#008800'>""</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>
      <font color='#AA0000'>(</font><font color='#0000AA'>lookup</font> <font color='#008800'>"host"</font> url<font color='#AA0000'>)</font>
      <font color='#AA0000'>(</font><font color='#0000AA'>if</font> <font color='#AA0000'>(</font><font color='#0000AA'>lookup</font> <font color='#008800'>"port"</font> url<font color='#AA0000'>)</font> <font color='#AA0000'>(</font><font color='#0000AA'>string</font> <font color='#008800'>":"</font> <font color='#AA0000'>(</font><font color='#0000AA'>lookup</font> <font color='#008800'>"port"</font> url<font color='#AA0000'>)</font><font color='#AA0000'>)</font> <font color='#008800'>""</font><font color='#AA0000'>)</font>
      <font color='#AA0000'>(</font><font color='#0000AA'>lookup</font> <font color='#008800'>"path"</font> url<font color='#AA0000'>)</font>
      <font color='#AA0000'>(</font><font color='#0000AA'>if</font> <font color='#AA0000'>(</font><font color='#0000AA'>null?</font> params<font color='#AA0000'>)</font> <font color='#008800'>""</font> <font color='#AA0000'>(</font><font color='#0000AA'>string</font> <font color='#008800'>"?"</font> <font color='#AA0000'>(</font>build-query params<font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>
      <font color='#AA0000'>(</font><font color='#0000AA'>if</font> <font color='#AA0000'>(</font><font color='#0000AA'>lookup</font> <font color='#008800'>"fragment"</font> url<font color='#AA0000'>)</font> <font color='#AA0000'>(</font><font color='#0000AA'>string</font> <font color='#008800'>"#"</font> <font color='#AA0000'>(</font><font color='#0000AA'>lookup</font> <font color='#008800'>"fragment"</font> url<font color='#AA0000'>)</font><font color='#AA0000'>)</font> <font color='#008800'>""</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>

<font color='#555555'>;===============================================================================</font>
<font color='#555555'>; !Headers, COOKIES, GET, and POST</font>
<font color='#555555'>;===============================================================================</font>

<font color='#555555'>;; <font color='#308080'>@syntax</font> (Web:header &lt;str-key&gt; &lt;str-value&gt;)</font>
<font color='#555555'>;; <font color='#308080'>@param</font> &lt;str-key&gt; the header name (e.g., "Content-type")</font>
<font color='#555555'>;; <font color='#308080'>@param</font> &lt;str-value&gt; the header value (e.g., "text/html")</font>
<font color='#555555'>;; &lt;p&gt;Sets an HTTP output header. Headers are printed using 'Web:send-headers'.&lt;/p&gt;</font>
<font color='#AA0000'>(</font><font color='#0000AA'>define</font> headers '<font color='#AA0000'>(</font><font color='#AA0000'>(</font><font color='#008800'>"Content-type"</font> <font color='#008800'>"text/html"</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>

<font color='#AA0000'>(</font><font color='#0000AA'>define</font> <font color='#AA0000'>(</font>header key value<font color='#AA0000'>)</font>
  <font color='#AA0000'>(</font><font color='#0000AA'>if</font> <font color='#AA0000'>(</font><font color='#0000AA'>lookup</font> key headers<font color='#AA0000'>)</font>
    <font color='#AA0000'>(</font><font color='#0000AA'>setf</font> <font color='#AA0000'>(</font><font color='#0000AA'>assoc</font> key headers<font color='#AA0000'>)</font> value<font color='#AA0000'>)</font>
    <font color='#AA0000'>(</font><font color='#0000AA'>push</font> <font color='#AA0000'>(</font><font color='#0000AA'>list</font> key value<font color='#AA0000'>)</font> headers <font color='#665500'>-1</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>

<font color='#555555'>;; <font color='#308080'>@syntax</font> (Web:redir &lt;str-url&gt;)</font>
<font color='#555555'>;; <font color='#308080'>@param</font> &lt;str-url&gt; a URL string</font>
<font color='#555555'>;; &lt;p&gt;Redirects the client to &lt;str-url&gt;.&lt;/p&gt;</font>
<font color='#AA0000'>(</font><font color='#0000AA'>define</font> <font color='#AA0000'>(</font>redir url<font color='#AA0000'>)</font>
  <font color='#AA0000'>(</font>header <font color='#008800'>"Location"</font> url<font color='#AA0000'>)</font><font color='#AA0000'>)</font>

<font color='#555555'>;; <font color='#308080'>@syntax</font> (Web:send-headers)</font>
<font color='#555555'>;; &lt;p&gt;Writes the HTTP headers to stdout. This function should be called regardless</font>
<font color='#555555'>;; of whether any headers have been manually set to ensure that the minimum HTTP</font>
<font color='#555555'>;; headers are properly sent. Note: no check is made to verify that output has not</font>
<font color='#555555'>;; already begun.&lt;/p&gt;</font>
<font color='#AA0000'>(</font><font color='#0000AA'>define</font> <font color='#AA0000'>(</font>send-headers<font color='#AA0000'>)</font>
  <font color='#AA0000'>(</font><font color='#0000AA'>dolist</font> <font color='#AA0000'>(</font>header headers<font color='#AA0000'>)</font>
    <font color='#AA0000'>(</font><font color='#0000AA'>print</font> <font color='#AA0000'>(</font><font color='#0000AA'>format</font> <font color='#008800'>"%s: %s&#092;n"</font> <font color='#AA0000'>(</font><font color='#0000AA'>first</font> header<font color='#AA0000'>)</font> <font color='#AA0000'>(</font><font color='#0000AA'>last</font> header<font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>
  <font color='#AA0000'>(</font><font color='#0000AA'>println</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>

<font color='#555555'>;; <font color='#308080'>@syntax</font> (Web:cookie &lt;str-key&gt;)</font>
<font color='#555555'>;; <font color='#308080'>@param</font> &lt;str-key&gt; the cookie's name</font>
<font color='#555555'>;; </font>
<font color='#555555'>;; <font color='#308080'>@syntax</font> (Web:cookie &lt;str-key&gt; &lt;str-value&gt; [&lt;int-expires&gt; [&lt;str-path&gt; [&lt;str-domain&gt; [&lt;bool-http-only&gt; [&lt;bool-secure-only&gt;]]]])</font>
<font color='#555555'>;; <font color='#308080'>@param</font> &lt;str-key&gt; the cookie's name</font>
<font color='#555555'>;; <font color='#308080'>@param</font> &lt;str-key&gt; the cookie's value</font>
<font color='#555555'>;; <font color='#308080'>@param</font> &lt;int-expires&gt; (optional) the expiration date of the cookie as a unix timestamp; default is a session cookie</font>
<font color='#555555'>;; <font color='#308080'>@param</font> &lt;str-path&gt; (optional) the cookie's path; default is the current path</font>
<font color='#555555'>;; <font color='#308080'>@param</font> &lt;str-domain&gt; (optional) the cookie's domain; default is the current host</font>
<font color='#555555'>;; <font color='#308080'>@param</font> &lt;bool-http-only&gt; (optional) whether the cookie may be read by client-side scripts</font>
<font color='#555555'>;; <font color='#308080'>@param</font> &lt;bool-secure-only&gt; (optional) whether the cookie may be accessed/set outside of HTTPS</font>
<font color='#555555'>;; &lt;p&gt;In the first syntax, 'cookie' returns the value of the cookie named &lt;str-key&gt; or 'nil'. If</font>
<font color='#555555'>;; &lt;str-key&gt; is not provided, an association list of all cookie values is returned.&lt;/p&gt;</font>
<font color='#555555'>;; &lt;p&gt;In the second syntax, 'cookie' sets a new cookie or overwrites an existing cookie in the</font>
<font color='#555555'>;; client's browser. Note that &lt;bool-http-only&gt; defaults to true, but is not standard and</font>
<font color='#555555'>;; therefore is not necessarily implemented in all browsers. &lt;bool-secure-only&gt; defaults to nil.</font>
<font color='#555555'>;; Cookies use the 'header' function and must be sent before calling 'send-headers'.&lt;/p&gt;</font>
<font color='#AA0000'>(</font><font color='#0000AA'>define</font> <font color='#AA0000'>(</font>cookie key value expires path domain http-only secure<font color='#AA0000'>)</font>
  <font color='#AA0000'>(</font><font color='#0000AA'>cond</font>
    <font color='#AA0000'>(</font><font color='#AA0000'>(</font><font color='#0000AA'>null?</font> key<font color='#AA0000'>)</font> COOKIES<font color='#AA0000'>)</font>
    <font color='#AA0000'>(</font><font color='#AA0000'>(</font><font color='#0000AA'>and</font> <font color='#AA0000'>(</font><font color='#0000AA'>null?</font> value<font color='#AA0000'>)</font> COOKIE<font color='#AA0000'>)</font>
     <font color='#AA0000'>(</font><font color='#0000AA'>lookup</font> key COOKIE<font color='#AA0000'>)</font><font color='#AA0000'>)</font>
    <font color='#AA0000'>(</font><font color='#0000AA'>true</font>
      <font color='#AA0000'>(</font><font color='#0000AA'>when</font> <font color='#AA0000'>(</font><font color='#0000AA'>or</font> <font color='#AA0000'>(</font><font color='#0000AA'>not</font> secure<font color='#AA0000'>)</font> <font color='#AA0000'>(</font><font color='#0000AA'>and</font> secure <font color='#AA0000'>(</font><font color='#0000AA'>starts-with</font> <font color='#AA0000'>(</font><font color='#0000AA'>lower-case</font> <font color='#AA0000'>(</font><font color='#0000AA'>env</font> <font color='#008800'>"SERVER_PROTOCOL"</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font> <font color='#008800'>"https"</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>
        <font color='#AA0000'>(</font>header <font color='#008800'>"Set-Cookie"</font>
          <font color='#AA0000'>(</font><font color='#0000AA'>format</font> <font color='#008800'>"%s=%s%s%s%s%s"</font>
            <font color='#AA0000'>(</font>url-encode <font color='#AA0000'>(</font><font color='#0000AA'>string</font> key<font color='#AA0000'>)</font><font color='#AA0000'>)</font>
            <font color='#AA0000'>(</font>url-encode <font color='#AA0000'>(</font><font color='#0000AA'>string</font> value<font color='#AA0000'>)</font><font color='#AA0000'>)</font>
            <font color='#AA0000'>(</font><font color='#0000AA'>if</font> expires <font color='#AA0000'>(</font><font color='#0000AA'>string</font> <font color='#008800'>"&#059; expires="</font> <font color='#AA0000'>(</font><font color='#0000AA'>date</font> expires <font color='#665500'>0</font> <font color='#008800'>"%a, %d-%b-%Y %H:%M:%S %Z"</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font> <font color='#008800'>""</font><font color='#AA0000'>)</font>
            <font color='#AA0000'>(</font><font color='#0000AA'>if</font> path <font color='#AA0000'>(</font><font color='#0000AA'>string</font> <font color='#008800'>"&#059; path="</font> path<font color='#AA0000'>)</font> <font color='#008800'>""</font><font color='#AA0000'>)</font>
            <font color='#AA0000'>(</font><font color='#0000AA'>if</font> domain <font color='#AA0000'>(</font><font color='#0000AA'>string</font> <font color='#008800'>"&#059; domain="</font> domain<font color='#AA0000'>)</font> <font color='#008800'>""</font><font color='#AA0000'>)</font>
            <font color='#AA0000'>(</font><font color='#0000AA'>if-not</font> http-only <font color='#008800'>"&#059; HttpOnly"</font> <font color='#008800'>""</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>

<font color='#555555'>;; <font color='#308080'>@syntax</font> (Web:get &lt;str-key&gt;)</font>
<font color='#555555'>;; &lt;p&gt;Returns the value of &lt;str-key&gt; in the query string or 'nil' if not present.</font>
<font color='#555555'>;; If &lt;str-key&gt; is not provided, returns an association list of all GET values.&lt;/p&gt;</font>
<font color='#AA0000'>(</font><font color='#0000AA'>define</font> <font color='#AA0000'>(</font>get key<font color='#AA0000'>)</font>
  <font color='#AA0000'>(</font><font color='#0000AA'>when</font> GET <font color='#AA0000'>(</font><font color='#0000AA'>if</font> key <font color='#AA0000'>(</font><font color='#0000AA'>lookup</font> key GET<font color='#AA0000'>)</font> GET<font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>

<font color='#555555'>;; <font color='#308080'>@syntax</font> (Web:post &lt;str-key&gt;)</font>
<font color='#555555'>;; &lt;p&gt;Returns the value of &lt;str-key&gt; in the client-submitted POST data or 'nil' if</font>
<font color='#555555'>;; not present. If &lt;str-key&gt; is not provided, returns an association list of all</font>
<font color='#555555'>;; POST values.&lt;/p&gt;</font>
<font color='#AA0000'>(</font><font color='#0000AA'>define</font> <font color='#AA0000'>(</font>post key<font color='#AA0000'>)</font>
  <font color='#AA0000'>(</font><font color='#0000AA'>when</font> POST <font color='#AA0000'>(</font><font color='#0000AA'>if</font> key <font color='#AA0000'>(</font><font color='#0000AA'>lookup</font> key POST<font color='#AA0000'>)</font> POST<font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>

<font color='#555555'>;===============================================================================</font>
<font color='#555555'>; !Session control</font>
<font color='#555555'>; notes:</font>
<font color='#555555'>;  * sessions require cookies to function</font>
<font color='#555555'>;  * close-session or MAIN:exit must be called to save session changes to disk</font>
<font color='#555555'>;===============================================================================</font>

<font color='#555555'>;; <font color='#308080'>@syntax</font> (Web:define-session-handlers &lt;fn-open&gt; &lt;fn-close&gt; &lt;fn-delete&gt; &lt;fn-clear&gt; &lt;fn-clean&gt;)</font>
<font color='#555555'>;; <font color='#308080'>@param</font> &lt;fn-open&gt; function to begin a new session</font>
<font color='#555555'>;; <font color='#308080'>@param</font> &lt;fn-close&gt; function to close a session, saving changes</font>
<font color='#555555'>;; <font color='#308080'>@param</font> &lt;fn-delete&gt; function to delete a session</font>
<font color='#555555'>;; <font color='#308080'>@param</font> &lt;fn-clean&gt; function to prune old sessions</font>
<font color='#555555'>;; &lt;p&gt;Defines handler functions to be called when various session control</font>
<font color='#555555'>;; functions are used, making custom session storage a fairly simple matter.&lt;/p&gt;</font>
<font color='#555555'>;; The required handler functions are:</font>
<font color='#555555'>;; &lt;ul&gt;</font>
<font color='#555555'>;; &lt;li&gt;'fn-open': called by 'open-session'; resumes or starts a new session storage instance, initializing the context tree&lt;/li&gt;</font>
<font color='#555555'>;; &lt;li&gt;'fn-close': called by 'close-session'; writes changes to a session to storage&lt;/li&gt;</font>
<font color='#555555'>;; &lt;li&gt;'fn-delete': called by 'delete-session'; deletes the entire session from storage&lt;/li&gt;</font>
<font color='#555555'>;; &lt;li&gt;'fn-clean': called by 'clean-sessions'; prunes old stored sessions&lt;/li&gt;</font>
<font color='#555555'>;; &lt;/ul&gt;</font>
<font color='#555555'>;; Some useful functions and variables for handler functions:</font>
<font color='#555555'>;; &lt;ul&gt;</font>
<font color='#555555'>;; &lt;li&gt;'session-id': function that returns the current session id and sets the session cookie when necessary&lt;/li&gt;</font>
<font color='#555555'>;; &lt;li&gt;'session-context': function that returns the session context dictionary&lt;/li&gt;</font>
<font color='#555555'>;; &lt;li&gt;'SESSION_MAX_AGE': a variable storing the number of seconds after which an orphan session should be deleted&lt;/li&gt;</font>
<font color='#555555'>;; &lt;/ul&gt;</font>
<font color='#AA0000'>(</font><font color='#0000AA'>define</font> <font color='#AA0000'>(</font>define-session-handlers fn-open fn-close fn-delete fn-clean<font color='#AA0000'>)</font>
  <font color='#AA0000'>(</font><font color='#0000AA'>setf</font> _open-session fn-open
        _close-session fn-close
        _delete-session fn-delete
        _clean-sessions fn-clean<font color='#AA0000'>)</font><font color='#AA0000'>)</font>

<font color='#555555'>;; <font color='#308080'>@syntax</font> (Web:session-id [&lt;str-sid&gt;])</font>
<font color='#555555'>;; <font color='#308080'>@param</font> &lt;str-sid&gt; (optional) the session ID to use</font>
<font color='#555555'>;; <font color='#308080'>@return</font> a unique session id for the client</font>
<font color='#555555'>;; &lt;p&gt;Creates or retrieves the client's session id. If this is a new session id,</font>
<font color='#555555'>;; a cookie is set in the client's browser to identify it on future loads.&lt;/p&gt;</font>
<font color='#555555'>;; &lt;p&gt;If &lt;str-sid&gt; is provided, it will be used as the new session ID.&lt;/p&gt;</font>
<font color='#AA0000'>(</font><font color='#0000AA'>define</font> <font color='#AA0000'>(</font>session-id sid<font color='#AA0000'>)</font>
  <font color='#AA0000'>(</font><font color='#0000AA'>setf</font> SESSION_ID
    <font color='#AA0000'>(</font><font color='#0000AA'>or</font> <font color='#AA0000'>(</font><font color='#0000AA'>when</font> sid
          <font color='#AA0000'>(</font>cookie SESSION_KEY sid<font color='#AA0000'>)</font>
          sid<font color='#AA0000'>)</font>
        SESSION_ID
        <font color='#AA0000'>(</font>cookie SESSION_KEY<font color='#AA0000'>)</font>
        <font color='#AA0000'>(</font><font color='#0000AA'>begin</font>
          <font color='#AA0000'>(</font><font color='#0000AA'>setf</font> sid <font color='#AA0000'>(</font><font color='#0000AA'>string</font> SESSION_PREFIX <font color='#008800'>"-"</font> <font color='#AA0000'>(</font><font color='#0000AA'>uuid</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>
          <font color='#AA0000'>(</font>cookie SESSION_KEY sid<font color='#AA0000'>)</font>
          sid<font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>

<font color='#555555'>;; <font color='#308080'>@syntax</font> (Web:session-context)</font>
<font color='#555555'>;; <font color='#308080'>@return</font> a symbol pointing to the current session's context dictionary</font>
<font color='#555555'>;; &lt;p&gt;Run-time session data is stored in a context tree. 'session-context'</font>
<font color='#555555'>;; returns the current session tree or creates a new one when necessary.</font>
<font color='#555555'>;; This function is primarily intended for session handlers' use; it is</font>
<font color='#555555'>;; typically more useful to call 'session' on its own to retrieve an association</font>
<font color='#555555'>;; list of key/value pairs in an application.&lt;/p&gt;</font>
<font color='#AA0000'>(</font><font color='#0000AA'>define</font> <font color='#AA0000'>(</font>session-context , ctx<font color='#AA0000'>)</font>
  <font color='#AA0000'>(</font><font color='#0000AA'>setf</font> ctx <font color='#AA0000'>(</font><font color='#0000AA'>sym</font> <font color='#AA0000'>(</font>session-id<font color='#AA0000'>)</font> 'MAIN<font color='#AA0000'>)</font><font color='#AA0000'>)</font>
  <font color='#AA0000'>(</font><font color='#0000AA'>unless</font> <font color='#AA0000'>(</font><font color='#0000AA'>context?</font> ctx<font color='#AA0000'>)</font>
    <font color='#AA0000'>(</font><font color='#0000AA'>context</font> ctx<font color='#AA0000'>)</font><font color='#AA0000'>)</font>
  ctx<font color='#AA0000'>)</font>

<font color='#555555'>;; <font color='#308080'>@syntax</font> (Web:open-session)</font>
<font color='#555555'>;; &lt;p&gt;Initializes the client's session.&lt;/p&gt;</font>
<font color='#AA0000'>(</font><font color='#0000AA'>define</font> <font color='#AA0000'>(</font>open-session<font color='#AA0000'>)</font>
  <font color='#AA0000'>(</font>_open-session<font color='#AA0000'>)</font>
  <font color='#AA0000'>(</font><font color='#0000AA'>setf</font> SESSION_STARTED <font color='#0000AA'>true</font><font color='#AA0000'>)</font>
  <font color='#AA0000'>(</font>session-id<font color='#AA0000'>)</font><font color='#AA0000'>)</font>

<font color='#555555'>;; <font color='#308080'>@syntax</font> (close-session)</font>
<font color='#555555'>;; &lt;p&gt;Writes any changes to the session to file. This is automatically called</font>
<font color='#555555'>;; when the distribution function 'exit' is called.&lt;/p&gt;</font>
<font color='#AA0000'>(</font><font color='#0000AA'>define</font> <font color='#AA0000'>(</font>close-session<font color='#AA0000'>)</font>
  <font color='#AA0000'>(</font><font color='#0000AA'>when</font> SESSION_STARTED
    <font color='#AA0000'>(</font>_close-session<font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>

<font color='#555555'>;; <font color='#308080'>@syntax</font> (delete-session)</font>
<font color='#555555'>;; &lt;p&gt;Deletes the session. Sessions are then turned off and 'open-session'</font>
<font color='#555555'>;; must be called again to use sessions further.&lt;/p&gt;</font>
<font color='#AA0000'>(</font><font color='#0000AA'>define</font> <font color='#AA0000'>(</font>delete-session<font color='#AA0000'>)</font>
  <font color='#AA0000'>(</font><font color='#0000AA'>unless</font> SESSION_STARTED <font color='#AA0000'>(</font><font color='#0000AA'>throw-error</font> <font color='#008800'>"session is not started"</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>
  <font color='#AA0000'>(</font>_delete-session<font color='#AA0000'>)</font>
  <font color='#AA0000'>(</font><font color='#0000AA'>delete</font> <font color='#AA0000'>(</font>session-context<font color='#AA0000'>)</font><font color='#AA0000'>)</font>
  <font color='#AA0000'>(</font>cookie SESSION_KEY <font color='#008800'>""</font> <font color='#665500'>0</font><font color='#AA0000'>)</font>
  <font color='#AA0000'>(</font><font color='#0000AA'>setf</font> SESSION_STARTED <font color='#0000AA'>nil</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>

<font color='#555555'>;; <font color='#308080'>@syntax</font> (clear-session)</font>
<font color='#555555'>;; &lt;p&gt;Clears all session variables.&lt;/p&gt;</font>
<font color='#AA0000'>(</font><font color='#0000AA'>define</font> <font color='#AA0000'>(</font>clear-session<font color='#AA0000'>)</font>
  <font color='#AA0000'>(</font><font color='#0000AA'>when</font> SESSION_STARTED
    <font color='#AA0000'>(</font><font color='#0000AA'>dotree</font> <font color='#AA0000'>(</font>s <font color='#AA0000'>(</font>session-context<font color='#AA0000'>)</font><font color='#AA0000'>)</font>
      <font color='#AA0000'>(</font><font color='#0000AA'>delete</font> <font color='#AA0000'>(</font><font color='#0000AA'>sym</font> s <font color='#AA0000'>(</font>session-context<font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>

<font color='#555555'>;; <font color='#308080'>@syntax</font> (clean-sessions)</font>
<font color='#555555'>;; &lt;p&gt;Cleans old session files. This function is not currently called automatically;</font>
<font color='#555555'>;; note that there is the possibility of a race condition with this function and other</font>
<font color='#555555'>;; session handling functions.&lt;/p&gt;</font>
<font color='#AA0000'>(</font><font color='#0000AA'>define</font> <font color='#AA0000'>(</font>clean-sessions<font color='#AA0000'>)</font>
  <font color='#AA0000'>(</font>_clean-sessions<font color='#AA0000'>)</font><font color='#AA0000'>)</font>

<font color='#555555'>;; <font color='#308080'>@syntax</font> (session [&lt;str-key&gt; [&lt;str-value&gt;]])</font>
<font color='#555555'>;; <font color='#308080'>@param</font> &lt;str-key&gt; the session key</font>
<font color='#555555'>;; <font color='#308080'>@param</font> &lt;str-value&gt; the new value</font>
<font color='#555555'>;; When called with both &lt;str-key&gt; and &lt;str-value&gt;, sets the session variable. When</font>
<font color='#555555'>;; called with only &lt;str-key&gt;, returns the value of &lt;str-key&gt;. Otherwise, returns</font>
<font color='#555555'>;; an association list of session variables. Returns nil if the session is not</font>
<font color='#555555'>;; opened.</font>
<font color='#AA0000'>(</font><font color='#0000AA'>define</font> <font color='#AA0000'>(</font>session key value<font color='#AA0000'>)</font>
  <font color='#AA0000'>(</font><font color='#0000AA'>cond</font>
    <font color='#AA0000'>(</font><font color='#AA0000'>(</font><font color='#0000AA'>not</font> SESSION_STARTED<font color='#AA0000'>)</font> <font color='#0000AA'>nil</font><font color='#AA0000'>)</font>
    <font color='#AA0000'>(</font><font color='#AA0000'>(</font><font color='#0000AA'>and</font> key value<font color='#AA0000'>)</font> <font color='#AA0000'>(</font><font color='#0000AA'>context</font> <font color='#AA0000'>(</font>session-context<font color='#AA0000'>)</font> key value<font color='#AA0000'>)</font><font color='#AA0000'>)</font>
    <font color='#AA0000'>(</font><font color='#AA0000'>(</font><font color='#0000AA'>true?</font> key<font color='#AA0000'>)</font> <font color='#AA0000'>(</font><font color='#0000AA'>context</font> <font color='#AA0000'>(</font>session-context<font color='#AA0000'>)</font> key<font color='#AA0000'>)</font><font color='#AA0000'>)</font>
    <font color='#AA0000'>(</font><font color='#0000AA'>true</font> <font color='#AA0000'>(</font><font color='#0000AA'>let</font> <font color='#AA0000'>(</font><font color='#AA0000'>(</font>alist '<font color='#AA0000'>(</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>
            <font color='#AA0000'>(</font><font color='#0000AA'>dotree</font> <font color='#AA0000'>(</font>s <font color='#AA0000'>(</font>session-context<font color='#AA0000'>)</font><font color='#AA0000'>)</font>
              <font color='#AA0000'>(</font><font color='#0000AA'>push</font> <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#AA0000'>(</font>name s<font color='#AA0000'>)</font> <font color='#AA0000'>(</font><font color='#0000AA'>context</font> <font color='#AA0000'>(</font>session-context<font color='#AA0000'>)</font> <font color='#AA0000'>(</font>name s<font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font> alist <font color='#665500'>-1</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>
            alist<font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>

<font color='#555555'>;===============================================================================</font>
<font color='#555555'>; !Default session handlers</font>
<font color='#555555'>; </font>
<font color='#555555'>; The default session handlers use newLISP's 'save' and 'load' functions to</font>
<font color='#555555'>; easily serialize and import context data to and from file records. The files</font>
<font color='#555555'>; are stored unencrypted, so a custom handler should be used on a shared</font>
<font color='#555555'>; system.</font>
<font color='#555555'>;===============================================================================</font>

<font color='#555555'>; Returns the name of the file in which the session data is stored.</font>
<font color='#AA0000'>(</font><font color='#0000AA'>define</font> <font color='#AA0000'>(</font>default-session-file<font color='#AA0000'>)</font>
  <font color='#AA0000'>(</font><font color='#0000AA'>string</font> SESSION_DIR <font color='#008800'>"/"</font> <font color='#AA0000'>(</font>session-id<font color='#AA0000'>)</font> <font color='#008800'>".lsp"</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>

<font color='#555555'>; Loads/creates the session file; creates a new context tree when</font>
<font color='#555555'>; necessary.</font>
<font color='#AA0000'>(</font><font color='#0000AA'>define</font> <font color='#AA0000'>(</font>default-open-session<font color='#AA0000'>)</font>
  <font color='#AA0000'>(</font><font color='#0000AA'>if</font> <font color='#AA0000'>(</font><font color='#0000AA'>file?</font> <font color='#AA0000'>(</font>default-session-file<font color='#AA0000'>)</font><font color='#AA0000'>)</font>
    <font color='#AA0000'>(</font><font color='#0000AA'>load</font> <font color='#AA0000'>(</font>default-session-file<font color='#AA0000'>)</font><font color='#AA0000'>)</font>
    <font color='#AA0000'>(</font><font color='#0000AA'>save</font> <font color='#AA0000'>(</font>default-session-file<font color='#AA0000'>)</font> <font color='#AA0000'>(</font>session-context<font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>

<font color='#555555'>; Saves the session context to the session file.</font>
<font color='#AA0000'>(</font><font color='#0000AA'>define</font> <font color='#AA0000'>(</font>default-close-session<font color='#AA0000'>)</font>
  <font color='#AA0000'>(</font><font color='#0000AA'>save</font> <font color='#AA0000'>(</font>default-session-file<font color='#AA0000'>)</font> <font color='#AA0000'>(</font>session-context<font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>

<font color='#555555'>; Deletes the session file.</font>
<font color='#AA0000'>(</font><font color='#0000AA'>define</font> <font color='#AA0000'>(</font>default-delete-session<font color='#AA0000'>)</font>
  <font color='#AA0000'>(</font><font color='#0000AA'>when</font> <font color='#AA0000'>(</font><font color='#0000AA'>file?</font> <font color='#AA0000'>(</font>default-session-file<font color='#AA0000'>)</font><font color='#AA0000'>)</font>
    <font color='#AA0000'>(</font><font color='#0000AA'>delete-file</font> <font color='#AA0000'>(</font>default-session-file<font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>

<font color='#555555'>; Deletes old session files.</font>
<font color='#AA0000'>(</font><font color='#0000AA'>define</font> <font color='#AA0000'>(</font>default-clean-sessions , f<font color='#AA0000'>)</font>
  <font color='#AA0000'>(</font><font color='#0000AA'>dolist</font> <font color='#AA0000'>(</font>tmp-file <font color='#AA0000'>(</font><font color='#0000AA'>directory</font> SESSION_DIR<font color='#AA0000'>)</font><font color='#AA0000'>)</font>
    <font color='#AA0000'>(</font><font color='#0000AA'>when</font> <font color='#AA0000'>(</font><font color='#0000AA'>starts-with</font> tmp-file SESSION_PREFIX<font color='#AA0000'>)</font>
      <font color='#AA0000'>(</font><font color='#0000AA'>setf</font> f <font color='#AA0000'>(</font><font color='#0000AA'>string</font> SESSION_DIR <font color='#008800'>"/"</font> tmp-file<font color='#AA0000'>)</font><font color='#AA0000'>)</font>
      <font color='#AA0000'>(</font><font color='#0000AA'>when</font> <font color='#AA0000'>(</font><font color='#0000AA'>></font> <font color='#AA0000'>(</font><font color='#0000AA'>-</font> <font color='#AA0000'>(</font><font color='#0000AA'>date-value</font><font color='#AA0000'>)</font> <font color='#AA0000'>(</font><font color='#0000AA'>file-info</font> f <font color='#665500'>5</font> <font color='#0000AA'>nil</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font> SESSION_MAX_AGE<font color='#AA0000'>)</font>
        <font color='#AA0000'>(</font><font color='#0000AA'>delete-file</font> f<font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>

<font color='#555555'>;===============================================================================</font>
<font color='#555555'>; !Templating</font>
<font color='#555555'>;===============================================================================</font>

<font color='#555555'>;; <font color='#308080'>@syntax</font> (Web:eval-template &lt;str-template&gt; &lt;ctx-context&gt;)</font>
<font color='#555555'>;; <font color='#308080'>@param</font> &lt;str-template&gt; a string containing the template syntax</font>
<font color='#555555'>;; <font color='#308080'>@param</font> &lt;ctx-context&gt; the context in which to evaluate the template</font>
<font color='#555555'>;; &lt;p&gt;Translates a template using ASP-like tags, creating small islands of</font>
<font color='#555555'>;; newLISP code in an HTML (or other) document. This is similar to the</font>
<font color='#555555'>;; distribution CGI module&amp;apos;s 'put-page' function, except that the short-cut</font>
<font color='#555555'>;; &amp;lt;%= foo %&amp;gt; is used to simply output the value of 'foo' and tags</font>
<font color='#555555'>;; may span multiple lines.&lt;/p&gt;</font>
<font color='#555555'>;; &lt;p&gt;Note that the opening and closing tags may be changed by setting the</font>
<font color='#555555'>;; values of 'Web:OPEN_TAG' and 'Web:CLOSE_TAG' if desired. The shortcut</font>
<font color='#555555'>;; print tag will be 'Web:OPEN_TAG' + '='.&lt;/p&gt;</font>
<font color='#555555'>;; <font color='#308080'>@example</font></font>
<font color='#555555'>;; (Web:eval-template "&amp;lt&#059;p&amp;gt&#059;&amp;lt&#059;%= (* 3 3) %&amp;gt&#059;&amp;lt&#059;/p&amp;gt&#059;")</font>
<font color='#555555'>;; =&amp;gt; "&amp;lt&#059;p&amp;gt&#059;9&amp;lt&#059;/p&amp;gt&#059;"</font>
<font color='#555555'>;; (Web:eval-template "&amp;lt&#059;p&amp;gt&#059;&amp;lt&#059;% (println (* 3 3)) %&amp;gt&#059;&amp;lt&#059;/p&amp;gt&#059;")</font>
<font color='#555555'>;; =&amp;gt; "&amp;lt&#059;p&amp;gt&#059;9&amp;lt&#059;/p&amp;gt&#059;"</font>
<font color='#AA0000'>(</font><font color='#0000AA'>define</font> OPEN_TAG <font color='#008800'>"<%"</font><font color='#AA0000'>)</font>
<font color='#AA0000'>(</font><font color='#0000AA'>define</font> CLOSE_TAG <font color='#008800'>"%>"</font><font color='#AA0000'>)</font>

<font color='#AA0000'>(</font><font color='#0000AA'>define</font> <font color='#AA0000'>(</font>eval-template str <font color='#AA0000'>(</font>ctx MAIN<font color='#AA0000'>)</font> , start end next-start next-end block <font color='#AA0000'>(</font>buf <font color='#008800'>""</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>
  <font color='#AA0000'>(</font><font color='#0000AA'>setf</font> start <font color='#AA0000'>(</font><font color='#0000AA'>find</font> OPEN_TAG str<font color='#AA0000'>)</font><font color='#AA0000'>)</font>
  <font color='#AA0000'>(</font><font color='#0000AA'>setf</font> end <font color='#AA0000'>(</font><font color='#0000AA'>find</font> CLOSE_TAG str<font color='#AA0000'>)</font><font color='#AA0000'>)</font>
  
  <font color='#555555'>;; Prevent use of code island tags inside code island from breaking parsing.</font>
  <font color='#AA0000'>(</font><font color='#0000AA'>when</font> <font color='#AA0000'>(</font><font color='#0000AA'>and</font> start end<font color='#AA0000'>)</font>
    <font color='#AA0000'>(</font><font color='#0000AA'>while</font> <font color='#AA0000'>(</font><font color='#0000AA'>and</font> <font color='#AA0000'>(</font><font color='#0000AA'>setf</font> next-end <font color='#AA0000'>(</font><font color='#0000AA'>find</font> CLOSE_TAG <font color='#AA0000'>(</font><font color='#0000AA'>slice</font> str <font color='#AA0000'>(</font><font color='#0000AA'>+</font> end <font color='#665500'>2</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>
                <font color='#AA0000'>(</font><font color='#0000AA'>setf</font> next-start <font color='#AA0000'>(</font><font color='#0000AA'>find</font> OPEN_TAG <font color='#AA0000'>(</font><font color='#0000AA'>slice</font> str <font color='#AA0000'>(</font><font color='#0000AA'>+</font> end <font color='#665500'>2</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>
                <font color='#AA0000'>(</font><font color='#0000AA'><</font> next-end next-start<font color='#AA0000'>)</font><font color='#AA0000'>)</font>
      <font color='#AA0000'>(</font><font color='#0000AA'>inc</font> end <font color='#AA0000'>(</font><font color='#0000AA'>+</font> next-end <font color='#665500'>2</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>
    <font color='#AA0000'>(</font><font color='#0000AA'>when</font> <font color='#AA0000'>(</font><font color='#0000AA'>and</font> start <font color='#AA0000'>(</font><font color='#0000AA'>not</font> end<font color='#AA0000'>)</font><font color='#AA0000'>)</font> <font color='#AA0000'>(</font><font color='#0000AA'>throw-error</font> <font color='#008800'>"Unbalanced tags."</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>
  
  <font color='#AA0000'>(</font><font color='#0000AA'>while</font> <font color='#AA0000'>(</font><font color='#0000AA'>and</font> start end<font color='#AA0000'>)</font>
    <font color='#AA0000'>(</font><font color='#0000AA'>write-buffer</font> buf <font color='#AA0000'>(</font><font color='#0000AA'>string</font> <font color='#008800'>"(print &#091;text]"</font> <font color='#AA0000'>(</font><font color='#0000AA'>slice</font> str <font color='#665500'>0</font> start<font color='#AA0000'>)</font> <font color='#008800'>"&#091;/text])"</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>
    <font color='#AA0000'>(</font><font color='#0000AA'>setf</font> block <font color='#AA0000'>(</font><font color='#0000AA'>slice</font> str <font color='#AA0000'>(</font><font color='#0000AA'>+</font> start <font color='#665500'>2</font><font color='#AA0000'>)</font> <font color='#AA0000'>(</font><font color='#0000AA'>-</font> end start <font color='#665500'>2</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>
    <font color='#AA0000'>(</font><font color='#0000AA'>if</font> <font color='#AA0000'>(</font><font color='#0000AA'>starts-with</font> block <font color='#008800'>"="</font><font color='#AA0000'>)</font>
      <font color='#AA0000'>(</font><font color='#0000AA'>write-buffer</font> buf <font color='#AA0000'>(</font><font color='#0000AA'>string</font> <font color='#008800'>"(print "</font> <font color='#AA0000'>(</font><font color='#0000AA'>rest</font> block<font color='#AA0000'>)</font> <font color='#008800'>")"</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>
      <font color='#AA0000'>(</font><font color='#0000AA'>write-buffer</font> buf <font color='#AA0000'>(</font><font color='#0000AA'>trim</font> block<font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>
    <font color='#AA0000'>(</font><font color='#0000AA'>setf</font> str <font color='#AA0000'>(</font><font color='#0000AA'>slice</font> str <font color='#AA0000'>(</font><font color='#0000AA'>+</font> end <font color='#665500'>2</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>
    <font color='#AA0000'>(</font><font color='#0000AA'>setf</font> start <font color='#AA0000'>(</font><font color='#0000AA'>find</font> OPEN_TAG str<font color='#AA0000'>)</font><font color='#AA0000'>)</font>
    <font color='#AA0000'>(</font><font color='#0000AA'>setf</font> end <font color='#AA0000'>(</font><font color='#0000AA'>find</font> CLOSE_TAG str<font color='#AA0000'>)</font><font color='#AA0000'>)</font>
    
    <font color='#555555'>;; Prevent use of code island tags inside code island from breaking parsing.</font>
    <font color='#AA0000'>(</font><font color='#0000AA'>when</font> <font color='#AA0000'>(</font><font color='#0000AA'>and</font> start end<font color='#AA0000'>)</font>
      <font color='#AA0000'>(</font><font color='#0000AA'>while</font> <font color='#AA0000'>(</font><font color='#0000AA'>and</font> <font color='#AA0000'>(</font><font color='#0000AA'>setf</font> next-end <font color='#AA0000'>(</font><font color='#0000AA'>find</font> CLOSE_TAG <font color='#AA0000'>(</font><font color='#0000AA'>slice</font> str <font color='#AA0000'>(</font><font color='#0000AA'>+</font> end <font color='#665500'>2</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>
                  <font color='#AA0000'>(</font><font color='#0000AA'>setf</font> next-start <font color='#AA0000'>(</font><font color='#0000AA'>find</font> OPEN_TAG <font color='#AA0000'>(</font><font color='#0000AA'>slice</font> str <font color='#AA0000'>(</font><font color='#0000AA'>+</font> end <font color='#665500'>2</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>
                  <font color='#AA0000'>(</font><font color='#0000AA'><</font> next-end next-start<font color='#AA0000'>)</font><font color='#AA0000'>)</font>
        <font color='#AA0000'>(</font><font color='#0000AA'>inc</font> end <font color='#AA0000'>(</font><font color='#0000AA'>+</font> next-end <font color='#665500'>2</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>
      <font color='#AA0000'>(</font><font color='#0000AA'>when</font> <font color='#AA0000'>(</font><font color='#0000AA'>and</font> start <font color='#AA0000'>(</font><font color='#0000AA'>not</font> end<font color='#AA0000'>)</font><font color='#AA0000'>)</font> <font color='#AA0000'>(</font><font color='#0000AA'>throw-error</font> <font color='#008800'>"Unbalanced tags."</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>
  
  <font color='#AA0000'>(</font><font color='#0000AA'>write-buffer</font> buf <font color='#AA0000'>(</font><font color='#0000AA'>string</font> <font color='#008800'>"(print &#091;text]"</font> str <font color='#008800'>"&#091;/text])"</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>
  <font color='#AA0000'>(</font><font color='#0000AA'>eval-string</font> buf ctx<font color='#AA0000'>)</font><font color='#AA0000'>)</font>

<font color='#555555'>;===============================================================================</font>
<font color='#555555'>; !Module initialization</font>
<font color='#555555'>; </font>
<font color='#555555'>; Install default session handlers and create the GET, POST, and COOKIE data</font>
<font color='#555555'>; structures.</font>
<font color='#555555'>;===============================================================================</font>

<font color='#555555'>; Content-Disposition: form-data; name="file"; filename="white-napkin.jpg"\r\nContent-Type: image/jpeg\r\n\r\n\253\152\191\160\128\144JFIF</font>
<font color='#555555'>; Content-Disposition: form-data; name="text"\r\n\r\nadsf\r\n</font>
<font color='#AA0000'>(</font><font color='#0000AA'>define</font> <font color='#AA0000'>(</font>mime-decode str , content-type parts re decoded<font color='#AA0000'>)</font>
  <font color='#AA0000'>(</font><font color='#0000AA'>when</font> <font color='#AA0000'>(</font><font color='#0000AA'>setf</font> content-type <font color='#AA0000'>(</font><font color='#0000AA'>regex</font> <font color='#008800'>{^multipart/form-data&#059; boundary=(.+?)$}</font> <font color='#AA0000'>(</font><font color='#0000AA'>env</font> <font color='#008800'>"CONTENT_TYPE"</font><font color='#AA0000'>)</font> <font color='#665500'>1</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>
    <font color='#AA0000'>(</font><font color='#0000AA'>setf</font> parts <font color='#AA0000'>(</font><font color='#0000AA'>find-all</font> <font color='#AA0000'>(</font><font color='#0000AA'>string</font> <font color='#008800'>"--"</font> <font color='#AA0000'>(</font>content-type <font color='#665500'>3</font><font color='#AA0000'>)</font> <font color='#008800'>{\r\n(.+?)(?=--)}</font><font color='#AA0000'>)</font> str $1 <font color='#AA0000'>(</font><font color='#0000AA'>|</font> <font color='#665500'>2</font> <font color='#665500'>4</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>
    <font color='#AA0000'>(</font><font color='#0000AA'>dolist</font> <font color='#AA0000'>(</font>part parts<font color='#AA0000'>)</font>
      <font color='#AA0000'>(</font><font color='#0000AA'>cond</font>
        <font color='#AA0000'>(</font><font color='#AA0000'>(</font><font color='#0000AA'>regex</font> <font color='#008800'>{Content-Disposition: form-data&#059; name=&#034;(.+?)&#034;\r\n\r\n(.*?)\s+}</font> part <font color='#665500'>1</font><font color='#AA0000'>)</font>
         <font color='#AA0000'>(</font><font color='#0000AA'>push</font> <font color='#AA0000'>(</font><font color='#0000AA'>list</font> $1 $2<font color='#AA0000'>)</font> decoded <font color='#665500'>-1</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>
        <font color='#AA0000'>(</font><font color='#AA0000'>(</font><font color='#0000AA'>regex</font> <font color='#008800'>{Content-Disposition: form-data&#059; name=&#034;(.+?)&#034;&#059; filename=&#034;(.+?)&#034;\r\nContent-Type: (.+?)\r\n\r\n(.*)$}</font> part <font color='#AA0000'>(</font><font color='#0000AA'>|</font> <font color='#665500'>1</font> <font color='#665500'>2</font> <font color='#665500'>4</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>
         <font color='#AA0000'>(</font><font color='#0000AA'>push</font> <font color='#AA0000'>(</font><font color='#0000AA'>list</font> $1 <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#008800'>"filename"</font> $2<font color='#AA0000'>)</font> <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#008800'>"content-type"</font> $3<font color='#AA0000'>)</font> <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#008800'>"bytes"</font> $4<font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font> decoded <font color='#665500'>-1</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>
    decoded<font color='#AA0000'>)</font><font color='#AA0000'>)</font>


<font color='#555555'>; Install default session handlers</font>
<font color='#AA0000'>(</font>define-session-handlers
  default-open-session
  default-close-session
  default-delete-session
  default-clean-sessions<font color='#AA0000'>)</font>

<font color='#555555'>; Read GET data</font>
<font color='#AA0000'>(</font><font color='#0000AA'>setf</font> GET
  <font color='#AA0000'>(</font><font color='#0000AA'>when</font> <font color='#AA0000'>(</font><font color='#0000AA'>env</font> <font color='#008800'>"QUERY_STRING"</font><font color='#AA0000'>)</font>
    <font color='#AA0000'>(</font>parse-query <font color='#AA0000'>(</font><font color='#0000AA'>env</font> <font color='#008800'>"QUERY_STRING"</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>

<font color='#555555'>; Read POST data</font>
<font color='#AA0000'>(</font><font color='#0000AA'>if-not</font> <font color='#AA0000'>(</font><font color='#0000AA'>context?</font> CGI<font color='#AA0000'>)</font>
  <font color='#555555'>;; CGI module not present; read and parse the POST data ourselves</font>
  <font color='#AA0000'>(</font><font color='#0000AA'>let</font> <font color='#AA0000'>(</font><font color='#AA0000'>(</font>post <font color='#008800'>""</font><font color='#AA0000'>)</font> <font color='#AA0000'>(</font>buffer <font color='#008800'>""</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>
   <font color='#AA0000'>(</font><font color='#0000AA'>unless</font> <font color='#AA0000'>(</font><font color='#0000AA'>zero?</font> <font color='#AA0000'>(</font><font color='#0000AA'>peek</font> <font color='#AA0000'>(</font><font color='#0000AA'>device</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>
    <font color='#AA0000'>(</font><font color='#0000AA'>while</font> <font color='#AA0000'>(</font><font color='#0000AA'>read-buffer</font> <font color='#AA0000'>(</font><font color='#0000AA'>device</font><font color='#AA0000'>)</font> buffer POST_LIMIT<font color='#AA0000'>)</font>
     <font color='#AA0000'>(</font><font color='#0000AA'>write-buffer</font> post buffer<font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>

   <font color='#AA0000'>(</font><font color='#0000AA'>setf</font> POST <font color='#AA0000'>(</font><font color='#0000AA'>when</font> post <font color='#AA0000'>(</font>parse-query post<font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>

<font color='#555555'>;This will replace the above line once mim-decode actually works.</font>
<font color='#555555'>;(setf POST</font>
<font color='#555555'>; (when post</font>
<font color='#555555'>;  (if (env "CONTENT_TYPE")</font>
<font color='#555555'>;   (mime-decode post)</font>
<font color='#555555'>;   (parse-query post)))))</font>
  
  <font color='#555555'>;; CGI module present; try to guess which values in CGI:params are</font>
  <font color='#555555'>;; from GET and which are from POST.</font>
  <font color='#AA0000'>(</font><font color='#0000AA'>begin</font>
    <font color='#AA0000'>(</font><font color='#0000AA'>setf</font> POST '<font color='#AA0000'>(</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>
    <font color='#AA0000'>(</font><font color='#0000AA'>dolist</font> <font color='#AA0000'>(</font>param CGI:params<font color='#AA0000'>)</font>
      <font color='#AA0000'>(</font><font color='#0000AA'>unless</font> <font color='#AA0000'>(</font><font color='#0000AA'>lookup</font> <font color='#AA0000'>(</font><font color='#0000AA'>first</font> param<font color='#AA0000'>)</font> GET<font color='#AA0000'>)</font>
        <font color='#AA0000'>(</font><font color='#0000AA'>push</font> param POST<font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>

<font color='#555555'>; Read COOKIE data</font>
<font color='#AA0000'>(</font><font color='#0000AA'>setf</font> COOKIE
  <font color='#AA0000'>(</font><font color='#0000AA'>when</font> <font color='#AA0000'>(</font><font color='#0000AA'>env</font> <font color='#008800'>"HTTP_COOKIE"</font><font color='#AA0000'>)</font>
    <font color='#AA0000'>(</font><font color='#0000AA'>map</font>
      <font color='#AA0000'>(</font>lambda <font color='#AA0000'>(</font>cookie , n<font color='#AA0000'>)</font>
        <font color='#AA0000'>(</font><font color='#0000AA'>setf</font> n <font color='#AA0000'>(</font><font color='#0000AA'>find</font> <font color='#008800'>"="</font> cookie<font color='#AA0000'>)</font><font color='#AA0000'>)</font>
        <font color='#AA0000'>(</font><font color='#0000AA'>list</font> <font color='#AA0000'>(</font>url-decode <font color='#AA0000'>(</font><font color='#0000AA'>slice</font> cookie <font color='#665500'>0</font> n<font color='#AA0000'>)</font><font color='#AA0000'>)</font>
              <font color='#AA0000'>(</font>url-decode <font color='#AA0000'>(</font><font color='#0000AA'>slice</font> cookie <font color='#AA0000'>(</font><font color='#0000AA'>+</font> <font color='#665500'>1</font> n<font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>
      <font color='#AA0000'>(</font><font color='#0000AA'>parse</font> <font color='#AA0000'>(</font><font color='#0000AA'>env</font> <font color='#008800'>"HTTP_COOKIE"</font><font color='#AA0000'>)</font> <font color='#008800'>"&#059; *"</font> <font color='#665500'>0</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>

<font color='#AA0000'>(</font><font color='#0000AA'>context</font> 'MAIN<font color='#AA0000'>)</font>

<font color='#555555'>; This function wraps the distribution exit routine to ensure that sessions are</font>
<font color='#555555'>; written when the application exits. It is only called when the 'exit' function</font>
<font color='#555555'>; is explicitly called. The 'exit' function is renamed 'sys-exit'. The 'Web'</font>
<font color='#555555'>; function 'close-session' is only called on a normal exit (exit code 0.)</font>
<font color='#AA0000'>(</font><font color='#0000AA'>define</font> <font color='#AA0000'>(</font>exit-with-session-close <font color='#AA0000'>(</font>n <font color='#665500'>0</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>
  <font color='#AA0000'>(</font><font color='#0000AA'>when</font> <font color='#AA0000'>(</font><font color='#0000AA'>zero?</font> n<font color='#AA0000'>)</font>
    <font color='#AA0000'>(</font>Web:close-session<font color='#AA0000'>)</font><font color='#AA0000'>)</font>
  <font color='#AA0000'>(</font>MAIN:sys-exit<font color='#AA0000'>)</font><font color='#AA0000'>)</font>

<font color='#AA0000'>(</font><font color='#0000AA'>constant</font> 'sys-exit <font color='#0000AA'>exit</font><font color='#AA0000'>)</font>
<font color='#AA0000'>(</font><font color='#0000AA'>constant</font> 'exit exit-with-session-close<font color='#AA0000'>)</font>


</pre><center><font face='Arial' size='-3' color='#666666'>syntax highlighting with <a href="http://newlisp.org">newLISP</a>&nbsp;and <a href="http://newlisp.org/newLISPdoc.html">newLISPdoc</a></font></center></body></html>