<!DOCTYPE HTML PUBLIC "4.01 Transitional"><html><title>Element</title><body><pre>
<font color='#555555'>;; <font color='#308080'>@module</font> Element</font>
<font color='#555555'>;; <font color='#308080'>@author</font> Jeff Ober &lt;jeffober@gmail.com&gt;</font>
<font color='#555555'>;; <font color='#308080'>@version</font> 1.0</font>
<font color='#555555'>;; <font color='#308080'>@location</font> http://static.artfulcode.net/newlisp/element.lsp</font>
<font color='#555555'>;; <font color='#308080'>@package</font> http://static.artfulcode.net/newlisp/element.qwerty</font>
<font color='#555555'>;; <font color='#308080'>@description</font> A simple way of generating valid XML content (requires newlisp 10).</font>
<font color='#555555'>;; Often, XML modules attempt to provide everything but the kitchen sink when</font>
<font color='#555555'>;; all that you &lt;really&gt; want is to write valid XML simply and quickly. Element</font>
<font color='#555555'>;; is a purely practical module that lets you write XML fast and efficiently. It</font>
<font color='#555555'>;; performs no validation and does nothing apart from serialize data to XML. If</font>
<font color='#555555'>;; you need extra functionality like indentation or serialization of SXML, look</font>
<font color='#555555'>;; at the XML module.</font>
<font color='#555555'>;; &lt;h4&gt;Version history&lt;/h4&gt;</font>
<font color='#555555'>;; &lt;b&gt;1.0&lt;/b&gt;</font>
<font color='#555555'>;; &amp;bull; initial release</font>
<font color='#555555'>;; &lt;h4&gt;Bugs and todos&lt;/h4&gt;</font>
<font color='#555555'>;; &amp;bull; XML declaration function with encoding</font>

<font color='#AA0000'>(</font><font color='#0000AA'>context</font> 'Element<font color='#AA0000'>)</font>

<font color='#AA0000'>(</font><font color='#0000AA'>constant</font> 'xml-entity-encode-re <font color='#AA0000'>(</font><font color='#0000AA'>regex-comp</font> <font color='#AA0000'>(</font><font color='#0000AA'>string</font> <font color='#008800'>"("</font> <font color='#AA0000'>(</font><font color='#0000AA'>join</font> <font color='#AA0000'>(</font><font color='#0000AA'>map</font> <font color='#AA0000'>(</font>fn <font color='#AA0000'>(</font>i<font color='#AA0000'>)</font> <font color='#AA0000'>(</font><font color='#0000AA'>format</font> <font color='#008800'>{\x%x}</font> i<font color='#AA0000'>)</font><font color='#AA0000'>)</font> '<font color='#AA0000'>(</font><font color='#665500'>34</font> <font color='#665500'>38</font> <font color='#665500'>39</font> <font color='#665500'>60</font> <font color='#665500'>62</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font> <font color='#008800'>"|"</font><font color='#AA0000'>)</font> <font color='#008800'>")"</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>

<font color='#555555'>;; <font color='#308080'>@syntax</font> (Element:encode &lt;str&gt;)</font>
<font color='#555555'>;; <font color='#308080'>@param</font> &lt;str&gt; a string</font>
<font color='#555555'>;; &lt;p&gt;Encodes characters in a string to be valid for XML.&lt;/p&gt;</font>
<font color='#AA0000'>(</font><font color='#0000AA'>define</font> <font color='#AA0000'>(</font>encode str<font color='#AA0000'>)</font>
  <font color='#AA0000'>(</font><font color='#0000AA'>replace</font> xml-entity-encode-re <font color='#AA0000'>(</font><font color='#0000AA'>string</font> str<font color='#AA0000'>)</font> <font color='#AA0000'>(</font><font color='#0000AA'>string</font> <font color='#008800'>"&amp;#"</font> <font color='#AA0000'>(</font><font color='#0000AA'>char</font> $1<font color='#AA0000'>)</font> <font color='#008800'>"&#059;"</font><font color='#AA0000'>)</font> <font color='#665500'>0x10000</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>

<font color='#AA0000'>(</font><font color='#0000AA'>define</font> <font color='#AA0000'>(</font>serialize-attributes attributes<font color='#AA0000'>)</font>
  <font color='#AA0000'>(</font><font color='#0000AA'>cond</font>
    <font color='#AA0000'>(</font><font color='#AA0000'>(</font><font color='#0000AA'>list?</font> attributes<font color='#AA0000'>)</font> <font color='#AA0000'>(</font><font color='#0000AA'>join</font> <font color='#AA0000'>(</font><font color='#0000AA'>map</font> <font color='#AA0000'>(</font>fn <font color='#AA0000'>(</font>pair<font color='#AA0000'>)</font> <font color='#AA0000'>(</font><font color='#0000AA'>format</font> <font color='#008800'>" %s=&#092;&#034;%s&#092;&#034;"</font> <font color='#AA0000'>(</font><font color='#0000AA'>map</font> encode pair<font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font> attributes<font color='#AA0000'>)</font> <font color='#008800'>""</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>
    <font color='#AA0000'>(</font><font color='#AA0000'>(</font><font color='#0000AA'>string?</font> attributes<font color='#AA0000'>)</font> <font color='#AA0000'>(</font><font color='#0000AA'>string</font> <font color='#008800'>" "</font> attributes<font color='#AA0000'>)</font><font color='#AA0000'>)</font>
    <font color='#AA0000'>(</font><font color='#0000AA'>true</font> <font color='#008800'>""</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>

<font color='#AA0000'>(</font><font color='#0000AA'>define</font> <font color='#AA0000'>(</font>opening-tag tag attributes<font color='#AA0000'>)</font>
  <font color='#AA0000'>(</font><font color='#0000AA'>string</font> <font color='#008800'>"<"</font> tag <font color='#AA0000'>(</font>serialize-attributes attributes<font color='#AA0000'>)</font> <font color='#008800'>">"</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>

<font color='#AA0000'>(</font><font color='#0000AA'>define</font> <font color='#AA0000'>(</font>closing-tag tag<font color='#AA0000'>)</font>
  <font color='#AA0000'>(</font><font color='#0000AA'>string</font> <font color='#008800'>"&lt;/"</font> tag <font color='#008800'>">"</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>

<font color='#AA0000'>(</font><font color='#0000AA'>define</font> <font color='#AA0000'>(</font>empty-tag tag attributes<font color='#AA0000'>)</font>
  <font color='#AA0000'>(</font><font color='#0000AA'>string</font> <font color='#008800'>"<"</font> tag <font color='#AA0000'>(</font>serialize-attributes attributes<font color='#AA0000'>)</font> <font color='#008800'>" /&gt;"</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>

<font color='#555555'>;; <font color='#308080'>@syntax</font> (Element:Element &lt;str-tag&gt; &lt;attributes&gt; [&lt;str-content&gt; ...])</font>
<font color='#555555'>;; <font color='#308080'>@param</font> &lt;str-tag&gt; the tag name</font>
<font color='#555555'>;; <font color='#308080'>@param</font> &lt;attributes&gt; an association list of key/value pairs, a string, or nil</font>
<font color='#555555'>;; <font color='#308080'>@param</font> &lt;str-content&gt; any number of strings</font>
<font color='#555555'>;; &lt;p&gt;Builds an element tag with the name &lt;str-tag&gt; and attributes &lt;attributes&gt;</font>
<font color='#555555'>;; around the content &lt;str-content&gt;, which generally is also built using this</font>
<font color='#555555'>;; function. If &lt;attributes&gt; is an association list, it is converted to a series</font>
<font color='#555555'>;; of key="value" pairs. If it is a string, it is inserted as-is. Otherwise, it</font>
<font color='#555555'>;; is ignored. &lt;str-content&gt; may be strings generated by XmlBuilder:element or</font>
<font color='#555555'>;; otherwise (in which case it is inserted as text content). Attribute values are</font>
<font color='#555555'>;; encoded as needed (if an association list); &lt;str-content&gt; must be encoded if</font>
<font color='#555555'>;; a text value.&lt;/p&gt;</font>
<font color='#555555'>;; <font color='#308080'>@example</font></font>
<font color='#555555'>;; (Element "div" '(("class" "content"))</font>
<font color='#555555'>;;   (Element "h2" nil (Element:encode "Welcome"))</font>
<font color='#555555'>;;   (Element "p" {class=&#034;message&#034;} (Element:encode "Hello world.")))</font>
<font color='#555555'>;; </font>
<font color='#555555'>;; => &lt;div class="content">&lt;h2&gt;Welcome&lt;/h2&gt;&lt;p class="message">Hello world.&lt;/p&gt;&lt;/div&gt;</font>
<font color='#AA0000'>(</font><font color='#0000AA'>define</font> <font color='#AA0000'>(</font>Element:Element tag attributes<font color='#AA0000'>)</font>
  <font color='#AA0000'>(</font><font color='#0000AA'>if</font> <font color='#AA0000'>(</font><font color='#0000AA'>empty?</font> <font color='#AA0000'>(</font><font color='#0000AA'>args</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>
    <font color='#AA0000'>(</font>empty-tag tag attributes<font color='#AA0000'>)</font>
    <font color='#AA0000'>(</font><font color='#0000AA'>string</font>
      <font color='#AA0000'>(</font>opening-tag tag attributes<font color='#AA0000'>)</font>
      <font color='#AA0000'>(</font><font color='#0000AA'>join</font> <font color='#AA0000'>(</font><font color='#0000AA'>map</font> <font color='#AA0000'>(</font>fn <font color='#AA0000'>(</font>a<font color='#AA0000'>)</font>
                   <font color='#AA0000'>(</font><font color='#0000AA'>if</font> <font color='#AA0000'>(</font><font color='#0000AA'>list?</font> a<font color='#AA0000'>)</font>
                     <font color='#AA0000'>(</font><font color='#0000AA'>join</font> <font color='#AA0000'>(</font><font color='#0000AA'>map</font> <font color='#0000AA'>string</font> a<font color='#AA0000'>)</font><font color='#AA0000'>)</font>
                     <font color='#AA0000'>(</font><font color='#0000AA'>string</font> a<font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>
                 <font color='#AA0000'>(</font><font color='#0000AA'>args</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>
      <font color='#AA0000'>(</font>closing-tag tag<font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>

<font color='#555555'>;; <font color='#308080'>@syntax</font> (Element:doc &lt;str-encoding&gt; [&lt;str-content&gt; ...])</font>
<font color='#555555'>;; <font color='#308080'>@param</font> &lt;str-encoding&gt; encoding for XML declaration</font>
<font color='#555555'>;; <font color='#308080'>@param</font> &lt;str-content&gt; any number of strings</font>
<font color='#555555'>;; &lt;p&gt;Adds an XML declaration to a string. If encoding is nil, defaults to UTF-8</font>
<font color='#555555'>;; when newlisp is compiled with UTF-8 support, ASCII otherwise.&lt;/p&gt;</font>
<font color='#555555'>;; <font color='#308080'>@example</font></font>
<font color='#555555'>;; (Element:doc "UTF-8" (Element "root" nil "Hello world."))</font>
<font color='#555555'>;; =></font>
<font color='#555555'>;; &lt;?xml version="1.0" encoding="UTF-8" ?></font>
<font color='#555555'>;; &lt;root&gt;Hello world.&lt;/root&gt;</font>
<font color='#AA0000'>(</font><font color='#0000AA'>define</font> <font color='#AA0000'>(</font>doc encoding<font color='#AA0000'>)</font>
  <font color='#AA0000'>(</font><font color='#0000AA'>unless</font> encoding <font color='#AA0000'>(</font><font color='#0000AA'>setq</font> encoding <font color='#AA0000'>(</font><font color='#0000AA'>if</font> <font color='#0000AA'>utf8</font> <font color='#008800'>"UTF-8"</font> <font color='#008800'>"ASCII"</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>
  <font color='#AA0000'>(</font><font color='#0000AA'>string</font> <font color='#008800'>{&lt;?xml version=&#034;1.0&#034; encoding=&#034;}</font> encoding <font color='#008800'>{&#034; ?>}</font> <font color='#008800'>"&#092;n"</font> <font color='#AA0000'>(</font><font color='#0000AA'>join</font> <font color='#AA0000'>(</font><font color='#0000AA'>map</font> <font color='#0000AA'>string</font> <font color='#AA0000'>(</font><font color='#0000AA'>args</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>

<font color='#AA0000'>(</font><font color='#0000AA'>context</font> 'MAIN<font color='#AA0000'>)</font>


</pre><center><font face='Arial' size='-3' color='#666666'>syntax highlighting with <a href="http://newlisp.org">newLISP</a>&nbsp;and <a href="http://newlisp.org/newLISPdoc.html">newLISPdoc</a></font></center></body></html>