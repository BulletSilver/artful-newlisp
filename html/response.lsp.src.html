<!DOCTYPE HTML PUBLIC "4.01 Transitional"><html><title>Response</title><body><pre>
<font color='#555555'>;; <font color='#308080'>@module</font> Response</font>
<font color='#555555'>;; <font color='#308080'>@author</font> Jeff Ober &lt;jeffober@gmail.com&gt;</font>
<font color='#555555'>;; <font color='#308080'>@version</font> 1.2.1</font>
<font color='#555555'>;; <font color='#308080'>@location</font> http://static.artfulcode.net/newlisp/response.lsp</font>
<font color='#555555'>;; <font color='#308080'>@package</font> http://static.artfulcode.net/newlisp/response.qwerty</font>
<font color='#555555'>;; <font color='#308080'>@description</font> Response module to replace output functions in the standard CGI module (updated for newlisp 10)</font>
<font color='#555555'>;; This module is independent of the Http module, and duplicates some of the effort there</font>
<font color='#555555'>;; by providing the ability to write headers to the HTTP output (such as the content-type and</font>
<font color='#555555'>;; the ability to redirect).  It is meant to be used with an existing CGI serving application,</font>
<font color='#555555'>;; such as Apache.</font>
<font color='#555555'>;;</font>
<font color='#555555'>;; Output is controlled using 'Response:write' or default functor (`Response:Response`),</font>
<font color='#555555'>;; which formats the output as a CGI response.  The result of 'Response:Response' is a</font>
<font color='#555555'>;; formatted string.  It is the application's responsibility to print this string or pass</font>
<font color='#555555'>;; it to the appropriate middle-man.</font>
<font color='#555555'>;; </font>
<font color='#555555'>;; &lt;h4&gt;Version history&lt;/h4&gt;</font>
<font color='#555555'>;; &lt;b&gt;1.2.1&lt;/b&gt;</font>
<font color='#555555'>;; &amp;bull; replaced deprecated set-assoc with setf in Response:header</font>
<font color='#555555'>;; </font>
<font color='#555555'>;; &lt;b&gt;1.2&lt;/b&gt;</font>
<font color='#555555'>;; &amp;bull; fixed incompatibilities with newlisp 10</font>
<font color='#555555'>;; </font>
<font color='#555555'>;; &lt;b&gt;1.1&lt;/b&gt;</font>
<font color='#555555'>;; &amp;bull; fixed bug in 'headers'</font>
<font color='#555555'>;; &amp;bull; fixed bug forcing text/html on all responses</font>
<font color='#555555'>;; </font>
<font color='#555555'>;; &lt;b&gt;1.0&lt;/b&gt;</font>
<font color='#555555'>;; &amp;bull; initial release</font>

<font color='#AA0000'>(</font><font color='#0000AA'>context</font> 'Response<font color='#AA0000'>)</font>

<font color='#AA0000'>(</font><font color='#0000AA'>set</font> '_response-codes
	 '<font color='#AA0000'>(</font><font color='#AA0000'>(</font><font color='#665500'>200</font> <font color='#008800'>"OK"</font><font color='#AA0000'>)</font>
	   <font color='#AA0000'>(</font><font color='#665500'>302</font> <font color='#008800'>"Found"</font><font color='#AA0000'>)</font>
	   <font color='#AA0000'>(</font><font color='#665500'>404</font> <font color='#008800'>"Not Found"</font><font color='#AA0000'>)</font>
	   <font color='#AA0000'>(</font><font color='#665500'>500</font> <font color='#008800'>"Internal Error"</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>

<font color='#AA0000'>(</font><font color='#0000AA'>set</font> '_response-code <font color='#665500'>200</font><font color='#AA0000'>)</font>
<font color='#AA0000'>(</font><font color='#0000AA'>set</font> '_content-type <font color='#008800'>"text/html&#059; charset=utf-8"</font><font color='#AA0000'>)</font>
<font color='#AA0000'>(</font><font color='#0000AA'>set</font> '_headers '<font color='#AA0000'>(</font><font color='#AA0000'>(</font><font color='#008800'>"Content-type"</font> <font color='#008800'>"text/html&#059; charset=utf-8"</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>
<font color='#AA0000'>(</font><font color='#0000AA'>set</font> '_cookies '<font color='#AA0000'>(</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>
<font color='#AA0000'>(</font><font color='#0000AA'>set</font> '_content <font color='#008800'>""</font><font color='#AA0000'>)</font>

<font color='#555555'>;;; functions for setting headers, adding content, and predicates.</font>

<font color='#555555'>;; <font color='#308080'>@syntax</font> (Response:write &lt;str-text&gt; ...)</font>
<font color='#555555'>;; <font color='#308080'>@param</font> &lt;str-text&gt; text to write to the output buffer</font>
<font color='#555555'>;; &lt;p&gt;'Response:write' allows programmatic output of CGI content.&lt;/p&gt;</font>
<font color='#555555'>;; <font color='#308080'>@example</font></font>
<font color='#555555'>;; (Response:write "&lt;html&gt;&#092;n")</font>
<font color='#555555'>;; (Response:write "&lt;head&gt;&lt;title&gt;Test page&lt;/title&gt;&lt;/head&gt;&#092;n")</font>
<font color='#555555'>;; (Response:write "&lt;body&gt;&lt;h3&gt;Hello world&lt;/h3&gt;&lt;/body&gt;&#092;n")</font>
<font color='#555555'>;; (Response:write "&lt;/html&gt;")</font>
<font color='#AA0000'>(</font><font color='#0000AA'>define</font> <font color='#AA0000'>(</font>Response:write<font color='#AA0000'>)</font>
  <font color='#AA0000'>(</font><font color='#0000AA'>doargs</font> <font color='#AA0000'>(</font>a<font color='#AA0000'>)</font> <font color='#AA0000'>(</font><font color='#0000AA'>write-buffer</font> _content <font color='#AA0000'>(</font><font color='#0000AA'>string</font> a<font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>

<font color='#555555'>;; <font color='#308080'>@syntax</font> (Response:header &lt;str-key&gt; &lt;str-val&gt;)</font>
<font color='#555555'>;; <font color='#308080'>@param</font> &lt;str-key&gt; header name</font>
<font color='#555555'>;; <font color='#308080'>@param</font> &lt;str-val&gt; header content</font>
<font color='#555555'>;; &lt;p&gt;Adds a new header to the output.&lt;/p&gt;</font>
<font color='#AA0000'>(</font><font color='#0000AA'>define</font> <font color='#AA0000'>(</font>header key val<font color='#AA0000'>)</font>
  <font color='#AA0000'>(</font><font color='#0000AA'>set</font> 'key <font color='#AA0000'>(</font><font color='#0000AA'>title-case</font> key<font color='#AA0000'>)</font><font color='#AA0000'>)</font>
  <font color='#AA0000'>(</font><font color='#0000AA'>if</font> <font color='#AA0000'>(</font><font color='#0000AA'>assoc</font> key _headers<font color='#AA0000'>)</font>
	    <font color='#AA0000'>(</font><font color='#0000AA'>setf</font> <font color='#AA0000'>(</font><font color='#0000AA'>assoc</font> key _headers<font color='#AA0000'>)</font> <font color='#AA0000'>(</font><font color='#0000AA'>list</font> key val<font color='#AA0000'>)</font><font color='#AA0000'>)</font>
	    <font color='#AA0000'>(</font><font color='#0000AA'>push</font> <font color='#AA0000'>(</font><font color='#0000AA'>list</font> key val<font color='#AA0000'>)</font> _headers<font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>

<font color='#555555'>;; <font color='#308080'>@syntax</font> (Response:header? &lt;str-key&gt;)</font>
<font color='#555555'>;; <font color='#308080'>@param</font> &lt;str-key&gt; header name</font>
<font color='#555555'>;; &lt;p&gt;Predicates that a header has already been added for output.&lt;/p&gt;</font>
<font color='#AA0000'>(</font><font color='#0000AA'>define</font> <font color='#AA0000'>(</font>header? key<font color='#AA0000'>)</font>
  <font color='#AA0000'>(</font><font color='#0000AA'>lookup</font> key _headers<font color='#AA0000'>)</font><font color='#AA0000'>)</font>

<font color='#555555'>;; <font color='#308080'>@syntax</font> (Response:headers)</font>
<font color='#555555'>;; &lt;p&gt;Returns an association list of headers that have been set.&lt;/p&gt;</font>
<font color='#AA0000'>(</font><font color='#0000AA'>define</font> <font color='#AA0000'>(</font>headers<font color='#AA0000'>)</font>
  _headers<font color='#AA0000'>)</font>

<font color='#AA0000'>(</font><font color='#0000AA'>define</font> <font color='#AA0000'>(</font>format-cookie key value domain path expires<font color='#AA0000'>)</font>
  <font color='#555555'>;; expires must be timestamp</font>
  <font color='#AA0000'>(</font><font color='#0000AA'>set</font> 'value <font color='#AA0000'>(</font><font color='#0000AA'>if</font> value <font color='#AA0000'>(</font><font color='#0000AA'>string</font> value<font color='#AA0000'>)</font> <font color='#008800'>""</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>
  <font color='#AA0000'>(</font><font color='#0000AA'>let</font> <font color='#AA0000'>(</font><font color='#AA0000'>(</font>cookie <font color='#008800'>""</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>
    <font color='#AA0000'>(</font><font color='#0000AA'>write-buffer</font> cookie <font color='#AA0000'>(</font><font color='#0000AA'>format</font> <font color='#008800'>"%s=%s&#059;"</font> key value<font color='#AA0000'>)</font><font color='#AA0000'>)</font>
    <font color='#AA0000'>(</font><font color='#0000AA'>if</font> domain
		    <font color='#AA0000'>(</font><font color='#0000AA'>write-buffer</font> cookie <font color='#AA0000'>(</font><font color='#0000AA'>format</font> <font color='#008800'>"&#059; domain=.%s"</font> domain<font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>
    <font color='#AA0000'>(</font><font color='#0000AA'>if</font> path
		    <font color='#AA0000'>(</font><font color='#0000AA'>write-buffer</font> cookie <font color='#AA0000'>(</font><font color='#0000AA'>format</font> <font color='#008800'>"&#059; path=%s"</font> path<font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>
    <font color='#AA0000'>(</font><font color='#0000AA'>if</font> expires
		    <font color='#AA0000'>(</font><font color='#0000AA'>write-buffer</font> cookie <font color='#AA0000'>(</font><font color='#0000AA'>format</font> <font color='#008800'>"&#059; expires=%s"</font> <font color='#AA0000'>(</font><font color='#0000AA'>date</font> <font color='#AA0000'>(</font><font color='#0000AA'>int</font> expires<font color='#AA0000'>)</font> <font color='#665500'>0</font> <font color='#008800'>"%a, %d %b %Y %H:%M:%S %Z"</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>
    cookie<font color='#AA0000'>)</font><font color='#AA0000'>)</font>

<font color='#555555'>;; <font color='#308080'>@syntax</font> (Response:set-cookie &lt;str-key&gt; &lt;str-value&gt; [&lt;str-domain&gt; [&lt;str-path&gt; [&lt;int-expires&gt;]]])</font>
<font color='#555555'>;; <font color='#308080'>@param</font> &lt;str-key&gt; the cookie's name</font>
<font color='#555555'>;; <font color='#308080'>@param</font> &lt;str-value&gt; the cookie's value</font>
<font color='#555555'>;; <font color='#308080'>@param</font> &lt;str-domain&gt; optional; the cookie's domain</font>
<font color='#555555'>;; <font color='#308080'>@param</font> &lt;str-path&gt; optional; the cookie's path</font>
<font color='#555555'>;; <font color='#308080'>@param</font> &lt;int-expires&gt; optional; integer timestamp suitable as an input to 'date'</font>
<font color='#555555'>;; &lt;p&gt;Adds a cookie to the output buffer.&lt;/p&gt;</font>
<font color='#555555'>;; <font color='#308080'>@example</font></font>
<font color='#555555'>;; (let ((sid (new-session-id)))</font>
<font color='#555555'>;;   (Response:set-cookie "session-id" sid nil nil (+ (date-value) (* 60 60))))</font>
<font color='#555555'>;; </font>
<font color='#555555'>;; => sets cookie "session-id" to the result of the function 'new-session-id' and</font>
<font color='#555555'>;;    an expiration date one hour in the future.</font>
<font color='#AA0000'>(</font><font color='#0000AA'>define</font> <font color='#AA0000'>(</font>set-cookie key value domain path expires<font color='#AA0000'>)</font>
  <font color='#AA0000'>(</font><font color='#0000AA'>if</font> <font color='#AA0000'>(</font>cookie-set? key '? domain path<font color='#AA0000'>)</font>
	  <font color='#AA0000'>(</font>delete-cookie key domain path<font color='#AA0000'>)</font><font color='#AA0000'>)</font>
  <font color='#AA0000'>(</font><font color='#0000AA'>push</font> <font color='#AA0000'>(</font><font color='#0000AA'>list</font> key value domain path expires<font color='#AA0000'>)</font> _cookies <font color='#665500'>-1</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>

<font color='#555555'>;; <font color='#308080'>@syntax</font> (Response:delete-cookie &lt;str-key&gt; [&lt;str-domain&gt; [&lt;str-path&gt;]])</font>
<font color='#555555'>;; <font color='#308080'>@param</font> &lt;str-key&gt; the cookie's name</font>
<font color='#555555'>;; <font color='#308080'>@param</font> &lt;str-domain&gt; optional; the cookie's domain</font>
<font color='#555555'>;; <font color='#308080'>@param</font> &lt;str-path&gt; optional; the cookie's path</font>
<font color='#555555'>;; &lt;p&gt;Deletes a cookie with matching key/domain/path that has been previously set.&lt;/p&gt;</font>
<font color='#555555'>;;; TODO: needs to check for set cookies in _cookies and remove</font>
<font color='#AA0000'>(</font><font color='#0000AA'>define</font> <font color='#AA0000'>(</font>delete-cookie key domain path<font color='#AA0000'>)</font>
  <font color='#AA0000'>(</font><font color='#0000AA'>if</font> <font color='#AA0000'>(</font>cookie-set? key '? domain path<font color='#AA0000'>)</font>
	  <font color='#AA0000'>(</font><font color='#0000AA'>pop</font> _cookies <font color='#AA0000'>(</font><font color='#0000AA'>find</font> <font color='#AA0000'>(</font><font color='#0000AA'>list</font> key '? domain path '?<font color='#AA0000'>)</font> _cookies <font color='#0000AA'>match</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>
	  <font color='#AA0000'>(</font>set-cookie key <font color='#0000AA'>nil</font> domain path <font color='#AA0000'>(</font><font color='#0000AA'>date-value</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>

<font color='#555555'>;; <font color='#308080'>@syntax</font> (Response:cookie-set? &lt;str-key&gt; [&lt;str-domain&gt; [&lt;str-path&gt;]])</font>
<font color='#555555'>;; <font color='#308080'>@param</font> &lt;str-key&gt; the cookie's name</font>
<font color='#555555'>;; <font color='#308080'>@param</font> &lt;str-domain&gt; optional; the cookie's domain</font>
<font color='#555555'>;; <font color='#308080'>@param</font> &lt;str-path&gt; optional; the cookie's path</font>
<font color='#555555'>;; &lt;p&gt;Predicates whether a cookie with a matching pattern has been previously set.&lt;/p&gt;</font>
<font color='#AA0000'>(</font><font color='#0000AA'>define</font> <font color='#AA0000'>(</font>cookie-set? key domain path<font color='#AA0000'>)</font>
  <font color='#AA0000'>(</font><font color='#0000AA'>true?</font> <font color='#AA0000'>(</font><font color='#0000AA'>find</font> <font color='#AA0000'>(</font><font color='#0000AA'>list</font> key '? domain path '?<font color='#AA0000'>)</font> _cookies <font color='#0000AA'>match</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>

<font color='#555555'>;;; utility functions for rendering of headers</font>

<font color='#AA0000'>(</font><font color='#0000AA'>define</font> <font color='#AA0000'>(</font>_write-cookies<font color='#AA0000'>)</font>
  <font color='#AA0000'>(</font><font color='#0000AA'>if-not</font> <font color='#AA0000'>(</font><font color='#0000AA'>null?</font> _cookies<font color='#AA0000'>)</font>
    <font color='#AA0000'>(</font><font color='#0000AA'>let</font> <font color='#AA0000'>(</font><font color='#AA0000'>(</font>buffer <font color='#008800'>""</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>
      <font color='#AA0000'>(</font><font color='#0000AA'>dolist</font> <font color='#AA0000'>(</font>cookie _cookies<font color='#AA0000'>)</font>
        <font color='#AA0000'>(</font><font color='#0000AA'>set</font> 'cookie <font color='#AA0000'>(</font><font color='#0000AA'>apply</font> format-cookie cookie<font color='#AA0000'>)</font><font color='#AA0000'>)</font>
        <font color='#AA0000'>(</font><font color='#0000AA'>write-buffer</font> buffer <font color='#AA0000'>(</font><font color='#0000AA'>string</font> <font color='#008800'>"Set-Cookie: "</font> cookie <font color='#008800'>"&#092;n"</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>
      buffer<font color='#AA0000'>)</font>
    <font color='#008800'>""</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>

<font color='#AA0000'>(</font><font color='#0000AA'>define</font> <font color='#AA0000'>(</font>_write-content str<font color='#AA0000'>)</font>
  <font color='#AA0000'>(</font><font color='#0000AA'>if</font> str <font color='#AA0000'>(</font><font color='#0000AA'>set</font> '_content str<font color='#AA0000'>)</font><font color='#AA0000'>)</font>
  <font color='#AA0000'>(</font><font color='#0000AA'>if</font> _content
	    <font color='#AA0000'>(</font><font color='#0000AA'>let</font> <font color='#AA0000'>(</font><font color='#AA0000'>(</font>buffer <font color='#008800'>""</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>
		    <font color='#AA0000'>(</font><font color='#0000AA'>write-buffer</font> buffer <font color='#AA0000'>(</font><font color='#0000AA'>string</font> <font color='#008800'>"Content-Length: "</font> <font color='#AA0000'>(</font><font color='#0000AA'>length</font> _content<font color='#AA0000'>)</font> <font color='#008800'>"&#092;n&#092;n"</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>
		    <font color='#AA0000'>(</font><font color='#0000AA'>write-buffer</font> buffer <font color='#AA0000'>(</font><font color='#0000AA'>string</font> _content<font color='#AA0000'>)</font><font color='#AA0000'>)</font>
		    buffer<font color='#AA0000'>)</font>
	      <font color='#008800'>""</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>

<font color='#AA0000'>(</font><font color='#0000AA'>set</font> '_response
  <font color='#AA0000'>(</font>lambda <font color='#AA0000'>(</font>str<font color='#AA0000'>)</font>
    <font color='#AA0000'>(</font><font color='#0000AA'>let</font> <font color='#AA0000'>(</font><font color='#AA0000'>(</font>buffer <font color='#008800'>""</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>
      <font color='#AA0000'>(</font><font color='#0000AA'>let</font> <font color='#AA0000'>(</font><font color='#AA0000'>(</font>response-text <font color='#AA0000'>(</font><font color='#0000AA'>lookup</font> _response-code _response-codes<font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>
        <font color='#AA0000'>(</font><font color='#0000AA'>write-buffer</font> buffer <font color='#AA0000'>(</font><font color='#0000AA'>string</font> <font color='#008800'>"Status: "</font> _response-code <font color='#008800'>" "</font> <font color='#AA0000'>(</font><font color='#0000AA'>lookup</font> _response-code _response-codes<font color='#AA0000'>)</font> <font color='#008800'>"&#092;n"</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>
        <font color='#AA0000'>(</font><font color='#0000AA'>dolist</font> <font color='#AA0000'>(</font>hdrs _headers<font color='#AA0000'>)</font>
          <font color='#AA0000'>(</font><font color='#0000AA'>write-buffer</font> buffer <font color='#AA0000'>(</font><font color='#0000AA'>string</font> <font color='#AA0000'>(</font><font color='#0000AA'>join</font> hdrs <font color='#008800'>": "</font><font color='#AA0000'>)</font> <font color='#008800'>"&#092;n"</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>
        <font color='#AA0000'>(</font><font color='#0000AA'>write-buffer</font> buffer <font color='#AA0000'>(</font>_write-cookies<font color='#AA0000'>)</font><font color='#AA0000'>)</font>
        <font color='#AA0000'>(</font><font color='#0000AA'>write-buffer</font> buffer <font color='#AA0000'>(</font>_write-content str<font color='#AA0000'>)</font><font color='#AA0000'>)</font>
        buffer<font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>

<font color='#555555'>;;; functions that render complete headers.  functions that need to override the</font>
<font color='#555555'>;;; default rendering of complete headers simply need to replace the lambda</font>
<font color='#555555'>;;; _response which returns a string containing the complete header.</font>

<font color='#555555'>;; <font color='#308080'>@syntax</font> (Response:Response [&lt;str-text&gt;])</font>
<font color='#555555'>;; <font color='#308080'>@param</font> &lt;str-text&gt; optional; string text to output</font>
<font color='#555555'>;; &lt;p&gt;The default functor will return a formatted response, suitable for CGI output.</font>
<font color='#555555'>;; If &lt;str-text&gt; is provided, this will be the output.  Otherwise, any content added</font>
<font color='#555555'>;; with 'Response:write' will be used.&lt;/p&gt;</font>
<font color='#555555'>;; &lt;p&gt;Output will include any necessary headers, including cookies, that were set</font>
<font color='#555555'>;; for this session.&lt;/p&gt;</font>
<font color='#555555'>;; &lt;p&gt;This module is not re-entrant, so in a stateful environment, it should be</font>
<font color='#555555'>;; prototyped using 'new' for each new response.&lt;/p&gt;</font>
<font color='#555555'>;; &lt;p&gt;The manner in which the response is rendered may be hacked by setting the</font>
<font color='#555555'>;; variable 'Response:_response' to a suitable lambda expression.  See the code for</font>
<font color='#555555'>;; more implementation details.&lt;/p&gt;</font>
<font color='#555555'>;; <font color='#308080'>@example</font></font>
<font color='#555555'>;; (Response "Hello world")</font>
<font color='#555555'>;; => "Status: 200 OK&#092;nContent-type: text/html&#059; charset=utf-8&#092;nContent-Length: 11&#092;n&#092;nHello world"</font>
<font color='#555555'>;; </font>
<font color='#555555'>;; (Response:write "Hello world")</font>
<font color='#555555'>;; (Response)</font>
<font color='#555555'>;; => "Status: 200 OK&#092;nContent-type: text/html&#059; charset=utf-8&#092;nContent-Length: 11&#092;n&#092;nHello world"</font>
<font color='#AA0000'>(</font><font color='#0000AA'>define</font> <font color='#AA0000'>(</font>Response:Response str<font color='#AA0000'>)</font>
  <font color='#AA0000'>(</font>_response str<font color='#AA0000'>)</font><font color='#AA0000'>)</font>

<font color='#555555'>;; <font color='#308080'>@syntax</font> (Response:redirect &lt;str-path&gt;)</font>
<font color='#555555'>;; <font color='#308080'>@param</font> &lt;str-path&gt; the url or path to redirect to</font>
<font color='#555555'>;; &lt;p&gt;Redirects the client to &lt;str-path&gt;.&lt;/p&gt;</font>
<font color='#555555'>;; <font color='#308080'>@example</font></font>
<font color='#555555'>;; (Response:redirect "/some/other/path")</font>
<font color='#555555'>;; => "Status: 302 Found&#092;nLocation: /some/other/path&#092;n&#092;n"</font>
<font color='#AA0000'>(</font><font color='#0000AA'>define</font> <font color='#AA0000'>(</font>redirect path<font color='#AA0000'>)</font>
  <font color='#AA0000'>(</font><font color='#0000AA'>set</font> '_response-code <font color='#665500'>302</font><font color='#AA0000'>)</font>
  <font color='#AA0000'>(</font>header <font color='#008800'>"Location"</font> path<font color='#AA0000'>)</font>
  <font color='#AA0000'>(</font><font color='#0000AA'>set</font> '_response
	   <font color='#AA0000'>(</font><font color='#0000AA'>expand</font> 
		'<font color='#AA0000'>(</font>lambda <font color='#AA0000'>(</font><font color='#AA0000'>)</font>
		   <font color='#AA0000'>(</font><font color='#0000AA'>string</font> <font color='#008800'>"Status: 302 Found&#092;n"</font> <font color='#AA0000'>(</font>_write-cookies<font color='#AA0000'>)</font> <font color='#008800'>"Location: "</font> path 
				   <font color='#008800'>"&#092;n&#092;n"</font><font color='#AA0000'>)</font><font color='#AA0000'>)</font>
		'path<font color='#AA0000'>)</font><font color='#AA0000'>)</font>
  <font color='#AA0000'>(</font>_response<font color='#AA0000'>)</font><font color='#AA0000'>)</font>

<font color='#555555'>;;; 404 and 500 errors accept a string to output as the 404 page or 500 page.</font>
<font color='#555555'>;;; These are useful as primitives for more sophisticated error-catching</font>
<font color='#555555'>;;; routines that output formatted error and not-found pages.</font>

<font color='#555555'>;; <font color='#308080'>@syntax</font> (Response:not-found &lt;str-message&gt;)</font>
<font color='#555555'>;; <font color='#308080'>@param</font> &lt;str-message&gt; 404 NOT FOUND error message to display</font>
<font color='#555555'>;; &lt;p&gt;Outputs a 404 NOT FOUND error message.&lt;/p&gt;</font>
<font color='#555555'>;; <font color='#308080'>@example</font></font>
<font color='#555555'>;; (Response:not-found "&lt;p&gt;These are not the droids you are looking for.&lt;/p&gt;")</font>
<font color='#555555'>;; => "Status: 404 Not Found&#092;nContent-type: text/html&#059; charset=utf-8&#092;nContent-Length: 52&#092;n&#092;n&lt;p&gt;These are not the droids you are looking for.&lt;/p&gt;"</font>
<font color='#AA0000'>(</font><font color='#0000AA'>define</font> <font color='#AA0000'>(</font>not-found str<font color='#AA0000'>)</font>
  <font color='#AA0000'>(</font><font color='#0000AA'>set</font> '_response-code <font color='#665500'>404</font><font color='#AA0000'>)</font>
  <font color='#AA0000'>(</font><font color='#0000AA'>set</font> '_content str<font color='#AA0000'>)</font>
  <font color='#AA0000'>(</font>_response<font color='#AA0000'>)</font><font color='#AA0000'>)</font>

<font color='#555555'>;; <font color='#308080'>@syntax</font> (Response:error &lt;str-message&gt;)</font>
<font color='#555555'>;; <font color='#308080'>@param</font> &lt;str-message&gt; 500 ERROR message to display</font>
<font color='#555555'>;; &lt;p&gt;Outputs a 500 ERROR message.&lt;/p&gt;</font>
<font color='#555555'>;; <font color='#308080'>@example</font></font>
<font color='#555555'>;; (Response:error "&lt;p&gt;An error occurred while processing this request.&lt;/p&gt;")</font>
<font color='#555555'>;; => "Status: 500 Internal Error&#092;nContent-type: text/html&#059; charset=utf-8&#092;nContent-Length: 55&#092;n&#092;n&lt;p&gt;An error occurred while processing this request.&lt;/p&gt;"</font>
<font color='#AA0000'>(</font><font color='#0000AA'>define</font> <font color='#AA0000'>(</font>error str<font color='#AA0000'>)</font>
  <font color='#AA0000'>(</font><font color='#0000AA'>set</font> '_response-code <font color='#665500'>500</font><font color='#AA0000'>)</font>
  <font color='#AA0000'>(</font><font color='#0000AA'>set</font> '_content str<font color='#AA0000'>)</font>
  <font color='#AA0000'>(</font>_response<font color='#AA0000'>)</font><font color='#AA0000'>)</font>

<font color='#AA0000'>(</font><font color='#0000AA'>context</font> MAIN<font color='#AA0000'>)</font>


</pre><center><font face='Arial' size='-3' color='#666666'>syntax highlighting with <a href="http://newlisp.org">newLISP</a>&nbsp;and <a href="http://newlisp.org/newLISPdoc.html">newLISPdoc</a></font></center></body></html>